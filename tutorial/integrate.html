
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Integration (scipy.integrate) &#8212; SciPy v1.7.0.dev0+1036.4ec6f29 Manual</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/scipy.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="../_static/scipy-mathjax/MathJax.js?config=scipy-mathjax"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimization (scipy.optimize)" href="optimize.html" />
    <link rel="prev" title="Special functions (scipy.special)" href="special.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/scipyshiny_small.png" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dev/index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/scipy/scipy" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="general.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="special.html">
   Special functions (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.special
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Integration (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.integrate
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optimize.html">
   Optimization (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.optimize
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="interpolate.html">
   Interpolation (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.interpolate
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fft.html">
   Fourier Transforms (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.fft
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="signal.html">
   Signal Processing (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.signal
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linalg.html">
   Linear Algebra (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.linalg
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arpack.html">
   Sparse eigenvalue problems with ARPACK
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="csgraph.html">
   Compressed Sparse Graph Routines (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.sparse.csgraph
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spatial.html">
   Spatial data structures and algorithms (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.spatial
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats.html">
   Statistics (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.stats
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ndimage.html">
   Multidimensional image processing (
   <code class="xref py py-obj docutils literal notranslate">
    <span class="pre">
     scipy.ndimage
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="io.html">
   File IO (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     scipy.io
    </span>
   </code>
   )
  </a>
 </li>
</ul>

    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-integration-quad">
   General integration (
   <code class="xref py py-func docutils literal notranslate">
    <span class="pre">
     quad
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-multiple-integration-dblquad-tplquad-nquad">
   General multiple integration (
   <code class="xref py py-func docutils literal notranslate">
    <span class="pre">
     dblquad
    </span>
   </code>
   ,
   <code class="xref py py-func docutils literal notranslate">
    <span class="pre">
     tplquad
    </span>
   </code>
   ,
   <code class="xref py py-func docutils literal notranslate">
    <span class="pre">
     nquad
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gaussian-quadrature">
   Gaussian quadrature
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#romberg-integration">
   Romberg Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integrating-using-samples">
   Integrating using Samples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#faster-integration-using-low-level-callback-functions">
   Faster integration using low-level callback functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ordinary-differential-equations-solve-ivp">
   Ordinary differential equations (
   <code class="xref py py-func docutils literal notranslate">
    <span class="pre">
     solve_ivp
    </span>
   </code>
   )
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solving-a-system-with-a-banded-jacobian-matrix">
     Solving a system with a banded Jacobian matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="integration-scipy-integrate">
<h1>Integration (<a class="reference internal" href="../reference/integrate.html#module-scipy.integrate" title="scipy.integrate"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.integrate</span></code></a>)<a class="headerlink" href="#integration-scipy-integrate" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../reference/integrate.html#module-scipy.integrate" title="scipy.integrate"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.integrate</span></code></a> sub-package provides several integration
techniques including an ordinary differential equation integrator. An
overview of the module is provided by the help command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">integrate</span><span class="p">)</span>
<span class="go"> Methods for Integrating Functions given function object.</span>

<span class="go">   quad          -- General purpose integration.</span>
<span class="go">   dblquad       -- General purpose double integration.</span>
<span class="go">   tplquad       -- General purpose triple integration.</span>
<span class="go">   fixed_quad    -- Integrate func(x) using Gaussian quadrature of order n.</span>
<span class="go">   quadrature    -- Integrate with given tolerance using Gaussian quadrature.</span>
<span class="go">   romberg       -- Integrate func using Romberg integration.</span>

<span class="go"> Methods for Integrating Functions given fixed samples.</span>

<span class="go">   trapezoid            -- Use trapezoidal rule to compute integral.</span>
<span class="go">   cumulative_trapezoid -- Use trapezoidal rule to cumulatively compute integral.</span>
<span class="go">   simpson              -- Use Simpson&#39;s rule to compute integral from samples.</span>
<span class="go">   romb                 -- Use Romberg Integration to compute integral from</span>
<span class="go">                        -- (2**k + 1) evenly-spaced samples.</span>

<span class="go">   See the special module&#39;s orthogonal polynomials (special) for Gaussian</span>
<span class="go">      quadrature roots and weights for other weighting factors and regions.</span>

<span class="go"> Interface to numerical integrators of ODE systems.</span>

<span class="go">   odeint        -- General integration of ordinary differential equations.</span>
<span class="go">   ode           -- Integrate ODE using VODE and ZVODE routines.</span>
</pre></div>
</div>
<section id="general-integration-quad">
<h2>General integration (<a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-func docutils literal notranslate"><span class="pre">quad</span></code></a>)<a class="headerlink" href="#general-integration-quad" title="Permalink to this headline">¶</a></h2>
<p>The function <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a> is provided to integrate a function of one
variable between two points. The points can be <span class="math notranslate nohighlight">\(\pm\infty\)</span>
(<span class="math notranslate nohighlight">\(\pm\)</span> <code class="docutils literal notranslate"><span class="pre">inf</span></code>) to indicate infinite limits. For example,
suppose you wish to integrate a bessel function <code class="docutils literal notranslate"><span class="pre">jv(2.5,</span> <span class="pre">x)</span></code> along
the interval <span class="math notranslate nohighlight">\([0, 4.5].\)</span></p>
<div class="math notranslate nohighlight">
\[I=\int_{0}^{4.5}J_{2.5}\left(x\right)\, dx.\]</div>
<p>This could be computed using <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">special</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">special</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span>
<span class="go">(1.1178179380783249, 7.8663172481899801e-09)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">18.0</span><span class="o">/</span><span class="mi">27</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.0</span><span class="o">/</span><span class="mi">27</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>                <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">fresnel</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span>
<span class="go">1.117817938088701</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">I</span><span class="p">))</span>
<span class="go">1.03761443881e-11</span>
</pre></div>
</div>
<p>The first argument to quad is a “callable” Python object (i.e., a
function, method, or class instance). Notice the use of a lambda-
function in this case as the argument. The next two arguments are the
limits of integration. The return value is a tuple, with the first
element holding the estimated value of the integral and the second
element holding an upper bound on the error. Notice, that in this
case, the true value of this integral is</p>
<div class="math notranslate nohighlight">
\[I=\sqrt{\frac{2}{\pi}}\left(\frac{18}{27}\sqrt{2}\cos\left(4.5\right)-\frac{4}{27}\sqrt{2}\sin\left(4.5\right)+\sqrt{2\pi}\textrm{Si}\left(\frac{3}{\sqrt{\pi}}\right)\right),\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\textrm{Si}\left(x\right)=\int_{0}^{x}\sin\left(\frac{\pi}{2}t^{2}\right)\, dt.\]</div>
<p>is the Fresnel sine integral. Note that the numerically-computed integral is
within <span class="math notranslate nohighlight">\(1.04\times10^{-11}\)</span> of the exact result — well below the
reported error bound.</p>
<p>If the function to integrate takes additional parameters, they can be provided
in the <em class="xref py py-obj">args</em> argument. Suppose that the following integral shall be calculated:</p>
<div class="math notranslate nohighlight">
\[I(a,b)=\int_{0}^{1} ax^2+b \, dx.\]</div>
<p>This integral can be evaluated by using the following code:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span>
<span class="go">(1.6666666666666667, 1.8503717077085944e-14)</span>
</pre></div>
</div>
<p>Infinite inputs are also allowed in <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a> by using <span class="math notranslate nohighlight">\(\pm\)</span>
<code class="docutils literal notranslate"><span class="pre">inf</span></code> as one of the arguments. For example, suppose that a numerical
value for the exponential integral:</p>
<div class="math notranslate nohighlight">
\[E_{n}\left(x\right)=\int_{1}^{\infty}\frac{e^{-xt}}{t^{n}}\, dt.\]</div>
<p>is desired (and the fact that this integral can be computed as
<code class="docutils literal notranslate"><span class="pre">special.expn(n,x)</span></code> is forgotten). The functionality of the function
<a class="reference internal" href="../reference/generated/scipy.special.expn.html#scipy.special.expn" title="scipy.special.expn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">special.expn</span></code></a> can be replicated by defining a new function
<code class="docutils literal notranslate"><span class="pre">vec_expint</span></code> based on the routine <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span><span class="o">**</span><span class="n">n</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">expint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vec_expint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">expint</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vec_expint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="go">array([ 0.1097,  0.0567,  0.0301,  0.0163,  0.0089,  0.0049])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">special</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">special</span><span class="o">.</span><span class="n">expn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
<span class="go">array([ 0.1097,  0.0567,  0.0301,  0.0163,  0.0089,  0.0049])</span>
</pre></div>
</div>
<p>The function which is integrated can even use the quad argument (though the
error bound may underestimate the error due to possible numerical error in the
integrand from the use of <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a> ). The integral in this case is</p>
<div class="math notranslate nohighlight">
\[I_{n}=\int_{0}^{\infty}\int_{1}^{\infty}\frac{e^{-xt}}{t^{n}}\, dt\, dx=\frac{1}{n}.\]</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">expint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(0.33333333324560266, 2.8548934485373678e-09)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">I3</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I3</span><span class="p">)</span>
<span class="go">0.333333333333</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I3</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">8.77306560731e-11</span>
</pre></div>
</div>
<p>This last example shows that multiple integration can be handled using
repeated calls to <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-func docutils literal notranslate"><span class="pre">quad</span></code></a>.</p>
</section>
<section id="general-multiple-integration-dblquad-tplquad-nquad">
<h2>General multiple integration (<a class="reference internal" href="../reference/generated/scipy.integrate.dblquad.html#scipy.integrate.dblquad" title="scipy.integrate.dblquad"><code class="xref py py-func docutils literal notranslate"><span class="pre">dblquad</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.integrate.tplquad.html#scipy.integrate.tplquad" title="scipy.integrate.tplquad"><code class="xref py py-func docutils literal notranslate"><span class="pre">tplquad</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.integrate.nquad.html#scipy.integrate.nquad" title="scipy.integrate.nquad"><code class="xref py py-func docutils literal notranslate"><span class="pre">nquad</span></code></a>)<a class="headerlink" href="#general-multiple-integration-dblquad-tplquad-nquad" title="Permalink to this headline">¶</a></h2>
<p>The mechanics for double and triple integration have been wrapped up into the
functions <a class="reference internal" href="../reference/generated/scipy.integrate.dblquad.html#scipy.integrate.dblquad" title="scipy.integrate.dblquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dblquad</span></code></a> and <a class="reference internal" href="../reference/generated/scipy.integrate.tplquad.html#scipy.integrate.tplquad" title="scipy.integrate.tplquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tplquad</span></code></a>. These functions take the function
to  integrate and four, or six arguments, respectively. The limits of all
inner integrals need to be defined as functions.</p>
<p>An example of using double integration to compute several values of
<span class="math notranslate nohighlight">\(I_{n}\)</span> is shown below:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span><span class="p">,</span> <span class="n">dblquad</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">dblquad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">t</span><span class="o">**</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="go">(0.2500000000043577, 1.29830334693681e-08)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">(0.33333333325010883, 1.3888461883425516e-08)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="go">(0.4999999999985751, 1.3894083651858995e-08)</span>
</pre></div>
</div>
<p>As example for non-constant limits consider the integral</p>
<div class="math notranslate nohighlight">
\[I=\int_{y=0}^{1/2}\int_{x=0}^{1-2y} x y \, dx\, dy=\frac{1}{96}.\]</div>
<p>This integral can be evaluated using the expression below (Note the use of the
non-constant lambda functions for the upper limit of the inner integral):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">dblquad</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">area</span> <span class="o">=</span> <span class="n">dblquad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">area</span>
<span class="go">(0.010416666666666668, 1.1564823173178715e-16)</span>
</pre></div>
</div>
<p>For n-fold integration, scipy provides the function <a class="reference internal" href="../reference/generated/scipy.integrate.nquad.html#scipy.integrate.nquad" title="scipy.integrate.nquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nquad</span></code></a>. The
integration bounds are an iterable object: either a list of constant bounds,
or a list of functions for the non-constant integration bounds. The order of
integration (and therefore the bounds) is from the innermost integral to the
outermost one.</p>
<p>The integral from above</p>
<div class="math notranslate nohighlight">
\[I_{n}=\int_{0}^{\infty}\int_{1}^{\infty}\frac{e^{-xt}}{t^{n}}\, dt\, dx=\frac{1}{n}\]</div>
<p>can be calculated as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span><span class="o">**</span><span class="n">N</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]])</span>
<span class="go">(0.20000000000002294, 1.2239614263187945e-08)</span>
</pre></div>
</div>
<p>Note that the order of arguments for <em class="xref py py-obj">f</em> must match the order of the
integration bounds; i.e., the inner integral with respect to <span class="math notranslate nohighlight">\(t\)</span> is on
the interval <span class="math notranslate nohighlight">\([1, \infty]\)</span> and the outer integral with respect to
<span class="math notranslate nohighlight">\(x\)</span> is on the interval <span class="math notranslate nohighlight">\([0, \infty]\)</span>.</p>
<p>Non-constant integration bounds can be treated in a similar manner; the
example from above</p>
<div class="math notranslate nohighlight">
\[I=\int_{y=0}^{1/2}\int_{x=0}^{1-2y} x y \, dx\, dy=\frac{1}{96}.\]</div>
<p>can be evaluated by means of</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">bounds_y</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">bounds_x</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">bounds_x</span><span class="p">,</span> <span class="n">bounds_y</span><span class="p">])</span>
<span class="go">(0.010416666666666668, 4.101620128472366e-16)</span>
</pre></div>
</div>
<p>which is the same result as before.</p>
</section>
<section id="gaussian-quadrature">
<h2>Gaussian quadrature<a class="headerlink" href="#gaussian-quadrature" title="Permalink to this headline">¶</a></h2>
<p>A few functions are also provided in order to perform simple Gaussian
quadrature over a fixed interval. The first is <a class="reference internal" href="../reference/generated/scipy.integrate.fixed_quad.html#scipy.integrate.fixed_quad" title="scipy.integrate.fixed_quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fixed_quad</span></code></a>, which
performs fixed-order Gaussian quadrature. The second function is
<a class="reference internal" href="../reference/generated/scipy.integrate.quadrature.html#scipy.integrate.quadrature" title="scipy.integrate.quadrature"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quadrature</span></code></a>, which performs Gaussian quadrature of multiple
orders until the difference in the integral estimate is beneath some
tolerance supplied by the user. These functions both use the module
<code class="docutils literal notranslate"><span class="pre">scipy.special.orthogonal</span></code>, which can calculate the roots and quadrature
weights of a large variety of orthogonal polynomials (the polynomials
themselves are available as special functions returning instances of
the polynomial class — e.g., <a class="reference internal" href="../reference/generated/scipy.special.legendre.html#scipy.special.legendre" title="scipy.special.legendre"><code class="xref py py-obj docutils literal notranslate"><span class="pre">special.legendre</span></code></a>).</p>
</section>
<section id="romberg-integration">
<h2>Romberg Integration<a class="headerlink" href="#romberg-integration" title="Permalink to this headline">¶</a></h2>
<p>Romberg’s method <a class="reference internal" href="#wpr" id="id1"><span>[WPR]</span></a> is another method for numerically evaluating an
integral. See the help function for <a class="reference internal" href="../reference/generated/scipy.integrate.romberg.html#scipy.integrate.romberg" title="scipy.integrate.romberg"><code class="xref py py-func docutils literal notranslate"><span class="pre">romberg</span></code></a> for further details.</p>
</section>
<section id="integrating-using-samples">
<h2>Integrating using Samples<a class="headerlink" href="#integrating-using-samples" title="Permalink to this headline">¶</a></h2>
<p>If the samples are equally-spaced and the number of samples available
is <span class="math notranslate nohighlight">\(2^{k}+1\)</span> for some integer <span class="math notranslate nohighlight">\(k\)</span>, then Romberg <a class="reference internal" href="../reference/generated/scipy.integrate.romb.html#scipy.integrate.romb" title="scipy.integrate.romb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">romb</span></code></a>
integration can be used to obtain high-precision estimates of the
integral using the available samples. Romberg integration uses the
trapezoid rule at step-sizes related by a power of two and then
performs Richardson extrapolation on these estimates to approximate
the integral with a higher degree of accuracy.</p>
<p>In case of arbitrary spaced samples, the two functions <a class="reference internal" href="../reference/generated/scipy.integrate.trapezoid.html#scipy.integrate.trapezoid" title="scipy.integrate.trapezoid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trapezoid</span></code></a>
and <a class="reference internal" href="../reference/generated/scipy.integrate.simpson.html#scipy.integrate.simpson" title="scipy.integrate.simpson"><code class="xref py py-obj docutils literal notranslate"><span class="pre">simpson</span></code></a> are available. They are using Newton-Coates formulas
of order 1 and 2 respectively to perform integration. The trapezoidal rule
approximates the function as a straight line between adjacent points, while
Simpson’s rule approximates the function between three adjacent points as a
parabola.</p>
<p>For an odd number of samples that are equally spaced Simpson’s rule is exact
if the function is a polynomial of order 3 or less. If the samples are not
equally spaced, then the result is exact only if the function is a polynomial
of order 2 or less.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y1</span> <span class="o">=</span> <span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I1</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
<span class="go">21.0</span>
</pre></div>
</div>
<p>This corresponds exactly to</p>
<div class="math notranslate nohighlight">
\[\int_{1}^{4} x^2 \, dx = 21,\]</div>
<p>whereas integrating the second function</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">y2</span> <span class="o">=</span> <span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I2</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
<span class="go">61.5</span>
</pre></div>
</div>
<p>does not correspond to</p>
<div class="math notranslate nohighlight">
\[\int_{1}^{4} x^3 \, dx = 63.75\]</div>
<p>because the order of the polynomial in f2 is larger than two.</p>
</section>
<section id="faster-integration-using-low-level-callback-functions">
<span id="quad-callbacks"></span><h2>Faster integration using low-level callback functions<a class="headerlink" href="#faster-integration-using-low-level-callback-functions" title="Permalink to this headline">¶</a></h2>
<p>A user desiring reduced integration times may pass a C function
pointer through <a class="reference internal" href="../reference/generated/scipy.LowLevelCallable.html#scipy.LowLevelCallable" title="scipy.LowLevelCallable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.LowLevelCallable</span></code></a> to <a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.integrate.dblquad.html#scipy.integrate.dblquad" title="scipy.integrate.dblquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dblquad</span></code></a>,
<a class="reference internal" href="../reference/generated/scipy.integrate.tplquad.html#scipy.integrate.tplquad" title="scipy.integrate.tplquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tplquad</span></code></a> or <a class="reference internal" href="../reference/generated/scipy.integrate.nquad.html#scipy.integrate.nquad" title="scipy.integrate.nquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nquad</span></code></a> and it will be integrated and return a result in
Python.  The performance increase here arises from two factors.  The
primary improvement is faster function evaluation, which is provided
by compilation of the function itself.  Additionally we have a speedup
provided by the removal of function calls between C and Python in
<a class="reference internal" href="../reference/generated/scipy.integrate.quad.html#scipy.integrate.quad" title="scipy.integrate.quad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quad</span></code></a>.  This method may provide a speed improvements of ~2x for
trivial functions such as sine but can produce a much more noticeable
improvements (10x+) for more complex functions.  This feature then, is
geared towards a user with numerically intensive integrations willing
to write a little C to reduce computation time significantly.</p>
<p>The approach can be used, for example, via <a class="reference external" href="https://docs.python.org/dev/library/ctypes.html#module-ctypes" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ctypes</span></code></a> in a few simple steps:</p>
<p>1.) Write an integrand function in C with the function signature
<code class="docutils literal notranslate"><span class="pre">double</span> <span class="pre">f(int</span> <span class="pre">n,</span> <span class="pre">double</span> <span class="pre">*x,</span> <span class="pre">void</span> <span class="pre">*user_data)</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is an
array containing the point the function f is evaluated at, and <code class="docutils literal notranslate"><span class="pre">user_data</span></code>
to arbitrary additional data you want to provide.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* testlib.c */</span>
<span class="kt">double</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">user_data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">user_data</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* corresponds to c + x - y * z */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>2.) Now compile this file to a shared/dynamic library (a quick search will help
with this as it is OS-dependent). The user must link any math libraries,
etc., used.  On linux this looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gcc -shared -fPIC -o testlib.so testlib.c
</pre></div>
</div>
<p>The output library will be referred to as <code class="docutils literal notranslate"><span class="pre">testlib.so</span></code>, but it may have a
different file extension. A library has now been created that can be loaded
into Python with <a class="reference external" href="https://docs.python.org/dev/library/ctypes.html#module-ctypes" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ctypes</span></code></a>.</p>
<p>3.) Load shared library into Python using <a class="reference external" href="https://docs.python.org/dev/library/ctypes.html#module-ctypes" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ctypes</span></code></a> and set <code class="docutils literal notranslate"><span class="pre">restypes</span></code> and
<code class="docutils literal notranslate"><span class="pre">argtypes</span></code> - this allows SciPy to interpret the function correctly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">ctypes</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">LowLevelCallable</span>

<span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;testlib.so&#39;</span><span class="p">))</span>
<span class="n">lib</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span>
<span class="n">lib</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">user_data</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>

<span class="n">func</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">user_data</span><span class="p">)</span>
</pre></div>
</div>
<p>The last <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*user_data</span></code> in the function is optional and can be omitted
(both in the C function and ctypes argtypes) if not needed. Note that the
coordinates are passed in as an array of doubles rather than a separate argument.</p>
<p>4.) Now integrate the library function as normally, here using <a class="reference internal" href="../reference/generated/scipy.integrate.nquad.html#scipy.integrate.nquad" title="scipy.integrate.nquad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nquad</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="go">(1200.0, 1.1102230246251565e-11)</span>
</pre></div>
</div>
<p>The Python tuple is returned as expected in a reduced amount of time.  All
optional parameters can be used with this method including specifying
singularities, infinite bounds, etc.</p>
</section>
<section id="ordinary-differential-equations-solve-ivp">
<h2>Ordinary differential equations (<a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-func docutils literal notranslate"><span class="pre">solve_ivp</span></code></a>)<a class="headerlink" href="#ordinary-differential-equations-solve-ivp" title="Permalink to this headline">¶</a></h2>
<p>Integrating a set of ordinary differential equations (ODEs) given
initial conditions is another useful example. The function
<a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> is available in SciPy for integrating a first-order
vector differential equation:</p>
<div class="math notranslate nohighlight">
\[\frac{d\mathbf{y}}{dt}=\mathbf{f}\left(\mathbf{y},t\right),\]</div>
<p>given initial conditions <span class="math notranslate nohighlight">\(\mathbf{y}\left(0\right)=y_{0}\)</span>, where
<span class="math notranslate nohighlight">\(\mathbf{y}\)</span> is a length <span class="math notranslate nohighlight">\(N\)</span> vector and <span class="math notranslate nohighlight">\(\mathbf{f}\)</span>
is a mapping from <span class="math notranslate nohighlight">\(\mathcal{R}^{N}\)</span> to <span class="math notranslate nohighlight">\(\mathcal{R}^{N}.\)</span>
A higher-order ordinary differential equation can always be reduced to
a differential equation of this type by introducing intermediate
derivatives into the <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> vector.</p>
<p>For example, suppose it is desired to find the solution to the
following second-order differential equation:</p>
<div class="math notranslate nohighlight">
\[\frac{d^{2}w}{dz^{2}}-zw(z)=0\]</div>
<p>with initial conditions <span class="math notranslate nohighlight">\(w\left(0\right)=\frac{1}{\sqrt[3]{3^{2}}\Gamma\left(\frac{2}{3}\right)}\)</span> and <span class="math notranslate nohighlight">\(\left.\frac{dw}{dz}\right|_{z=0}=-\frac{1}{\sqrt[3]{3}\Gamma\left(\frac{1}{3}\right)}.\)</span> It is known that the solution to this differential equation with these
boundary conditions is the Airy function</p>
<div class="math notranslate nohighlight">
\[w=\textrm{Ai}\left(z\right),\]</div>
<p>which gives a means to check the integrator using <a class="reference internal" href="../reference/generated/scipy.special.airy.html#scipy.special.airy" title="scipy.special.airy"><code class="xref py py-func docutils literal notranslate"><span class="pre">special.airy</span></code></a>.</p>
<p>First, convert this ODE into standard form by setting
<span class="math notranslate nohighlight">\(\mathbf{y}=\left[\frac{dw}{dz},w\right]\)</span> and <span class="math notranslate nohighlight">\(t=z\)</span>. Thus,
the differential equation becomes</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{d\mathbf{y}}{dt}=\left[\begin{array}{c} ty_{1}\\ y_{0}\end{array}\right]=\left[\begin{array}{cc} 0 &amp; t\\ 1 &amp; 0\end{array}\right]\left[\begin{array}{c} y_{0}\\ y_{1}\end{array}\right]=\left[\begin{array}{cc} 0 &amp; t\\ 1 &amp; 0\end{array}\right]\mathbf{y}.\end{split}\]</div>
<p>In other words,</p>
<div class="math notranslate nohighlight">
\[\mathbf{f}\left(\mathbf{y},t\right)=\mathbf{A}\left(t\right)\mathbf{y}.\]</div>
<p>As an interesting reminder, if <span class="math notranslate nohighlight">\(\mathbf{A}\left(t\right)\)</span>
commutes with <span class="math notranslate nohighlight">\(\int_{0}^{t}\mathbf{A}\left(\tau\right)\, d\tau\)</span>
under matrix multiplication, then this linear differential equation
has an exact solution using the matrix exponential:</p>
<div class="math notranslate nohighlight">
\[\mathbf{y}\left(t\right)=\exp\left(\int_{0}^{t}\mathbf{A}\left(\tau\right)d\tau\right)\mathbf{y}\left(0\right),\]</div>
<p>However, in this case, <span class="math notranslate nohighlight">\(\mathbf{A}\left(t\right)\)</span> and its integral do not commute.</p>
<p>This differential equation can be solved using the function <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a>.
It requires the derivative, <em>fprime</em>, the time span <em class="xref py py-obj">[t_start, t_end]</em>
and the initial conditions vector, <em>y0</em>, as input arguments and returns
an object whose <em>y</em> field is an array with consecutive solution values as
columns. The initial conditions are therefore given in the first output column.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">airy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y1_0</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y0_0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0_0</span><span class="p">,</span> <span class="n">y1_0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_span</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sol1</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sol1.t: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">t</span><span class="p">))</span>
<span class="go">sol1.t:    [0.         0.10097672 1.04643602 1.91060117 2.49872472 3.08684827</span>
<span class="go"> 3.62692846 4.        ]</span>
</pre></div>
</div>
<p>As it can be seen <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> determines its time steps automatically if not
specified otherwise. To compare the solution of <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> with the <em class="xref py py-obj">airy</em>
function the time vector created by <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> is passed to the <em class="xref py py-obj">airy</em> function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sol1.y[1]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="go">sol1.y[1]: [0.35502805 0.328952   0.12801343 0.04008508 0.01601291 0.00623879</span>
<span class="go"> 0.00356316 0.00405982]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;airy(sol.t)[0]:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">airy</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="go">airy(sol.t)[0]: [0.35502805 0.328952   0.12804768 0.03995804 0.01575943 0.00562799</span>
<span class="go"> 0.00201689 0.00095156]</span>
</pre></div>
</div>
<p>The solution of <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> with its standard parameters shows a big deviation
to the airy function. To minimize this deviation, relative and absolute
tolerances can be used.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sol2</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sol2.y[1][::6]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sol2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">6</span><span class="p">]))</span>
<span class="go">sol2.y[1][::6]: [0.35502805 0.19145234 0.06368989 0.0205917  0.00554734 0.00106409]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;airy(sol2.t)[0][::6]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">airy</span><span class="p">(</span><span class="n">sol2</span><span class="o">.</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][::</span><span class="mi">6</span><span class="p">]))</span>
<span class="go">airy(sol2.t)[0][::6]: [0.35502805 0.19145234 0.06368989 0.0205917  0.00554733 0.00106406]</span>
</pre></div>
</div>
<p>To specify user defined time points for the solution of <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a>
offers two possibilities that can also be used complementarily. By passing the <em class="xref py py-obj">t_eval</em>
option to the function call <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a> returns the solutions of these time points
of <em class="xref py py-obj">t_eval</em> in its output.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sol3</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>If the jacobian matrix of function is known, it can be passed to the <a class="reference internal" href="../reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp" title="scipy.integrate.solve_ivp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_ivp</span></code></a>
to achieve better results. Please be aware however that the default integration method
<a class="reference internal" href="../reference/generated/scipy.integrate.RK45.html#scipy.integrate.RK45" title="scipy.integrate.RK45"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RK45</span></code></a> does not support jacobian matrices and thereby another integration method has
to be chosen. One of the integration methods that support a jacobian matrix is the for
example the <a class="reference internal" href="../reference/generated/scipy.integrate.Radau.html#scipy.integrate.Radau" title="scipy.integrate.Radau"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Radau</span></code></a> method of following example.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sol4</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Radau&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">gradient</span><span class="p">)</span>
</pre></div>
</div>
<section id="solving-a-system-with-a-banded-jacobian-matrix">
<h3>Solving a system with a banded Jacobian matrix<a class="headerlink" href="#solving-a-system-with-a-banded-jacobian-matrix" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../reference/generated/scipy.integrate.odeint.html#scipy.integrate.odeint" title="scipy.integrate.odeint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odeint</span></code></a> can be told that the Jacobian is <em>banded</em>.  For a large
system of differential equations that are known to be stiff, this
can improve performance significantly.</p>
<p>As an example, we’ll solve the 1-D Gray-Scott partial
differential equations using the method of lines <a class="reference internal" href="#mol" id="id2"><span>[MOL]</span></a>.  The Gray-Scott equations
for the functions <span class="math notranslate nohighlight">\(u(x, t)\)</span> and <span class="math notranslate nohighlight">\(v(x, t)\)</span> on the interval
<span class="math notranslate nohighlight">\(x \in [0, L]\)</span> are</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
\frac{\partial u}{\partial t} = D_u \frac{\partial^2 u}{\partial x^2} - uv^2 + f(1-u) \\
\frac{\partial v}{\partial t} = D_v \frac{\partial^2 v}{\partial x^2} + uv^2 - (f + k)v \\
\end{split}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(D_u\)</span> and <span class="math notranslate nohighlight">\(D_v\)</span> are the diffusion coefficients of the
components <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span>, respectively, and <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(k\)</span>
are constants.  (For more information about the system, see
<a class="reference external" href="http://groups.csail.mit.edu/mac/projects/amorphous/GrayScott/">http://groups.csail.mit.edu/mac/projects/amorphous/GrayScott/</a>)</p>
<p>We’ll assume Neumann (i.e., “no flux”) boundary conditions:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial u}{\partial x}(0,t) = 0, \quad
\frac{\partial v}{\partial x}(0,t) = 0, \quad
\frac{\partial u}{\partial x}(L,t) = 0, \quad
\frac{\partial v}{\partial x}(L,t) = 0\]</div>
<p>To apply the method of lines, we discretize the <span class="math notranslate nohighlight">\(x\)</span> variable by defining
the uniformly spaced grid of <span class="math notranslate nohighlight">\(N\)</span> points <span class="math notranslate nohighlight">\(\left\{x_0, x_1, \ldots, x_{N-1}\right\}\)</span>, with
<span class="math notranslate nohighlight">\(x_0 = 0\)</span> and <span class="math notranslate nohighlight">\(x_{N-1} = L\)</span>.
We define <span class="math notranslate nohighlight">\(u_j(t) \equiv u(x_k, t)\)</span> and <span class="math notranslate nohighlight">\(v_j(t) \equiv v(x_k, t)\)</span>, and
replace the <span class="math notranslate nohighlight">\(x\)</span> derivatives with finite differences.  That is,</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^2 u}{\partial x^2}(x_j, t) \rightarrow
    \frac{u_{j-1}(t) - 2 u_{j}(t) + u_{j+1}(t)}{(\Delta x)^2}\]</div>
<p>We then have a system of <span class="math notranslate nohighlight">\(2N\)</span> ordinary differential equations:</p>
<div class="math notranslate nohighlight" id="equation-interior">
<span class="eqno">(1)<a class="headerlink" href="#equation-interior" title="Permalink to this equation">¶</a></span>\[\begin{split} \begin{split}
 \frac{du_j}{dt} = \frac{D_u}{(\Delta x)^2} \left(u_{j-1} - 2 u_{j} + u_{j+1}\right)
       -u_jv_j^2 + f(1 - u_j) \\
 \frac{dv_j}{dt} = \frac{D_v}{(\Delta x)^2} \left(v_{j-1} - 2 v_{j} + v_{j+1}\right)
       + u_jv_j^2 - (f + k)v_j
 \end{split}\end{split}\]</div>
<p>For convenience, the <span class="math notranslate nohighlight">\((t)\)</span> arguments have been dropped.</p>
<p>To enforce the boundary conditions, we introduce “ghost” points
<span class="math notranslate nohighlight">\(x_{-1}\)</span> and <span class="math notranslate nohighlight">\(x_N\)</span>, and define <span class="math notranslate nohighlight">\(u_{-1}(t) \equiv u_1(t)\)</span>,
<span class="math notranslate nohighlight">\(u_N(t) \equiv u_{N-2}(t)\)</span>; <span class="math notranslate nohighlight">\(v_{-1}(t)\)</span> and <span class="math notranslate nohighlight">\(v_N(t)\)</span>
are defined analogously.</p>
<p>Then</p>
<div class="math notranslate nohighlight" id="equation-boundary0">
<span class="eqno">(2)<a class="headerlink" href="#equation-boundary0" title="Permalink to this equation">¶</a></span>\[\begin{split} \begin{split}
 \frac{du_0}{dt} = \frac{D_u}{(\Delta x)^2} \left(2u_{1} - 2 u_{0}\right)
       -u_0v_0^2 + f(1 - u_0) \\
 \frac{dv_0}{dt} = \frac{D_v}{(\Delta x)^2} \left(2v_{1} - 2 v_{0}\right)
       + u_0v_0^2 - (f + k)v_0
 \end{split}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-boundaryl">
<span class="eqno">(3)<a class="headerlink" href="#equation-boundaryl" title="Permalink to this equation">¶</a></span>\[\begin{split} \begin{split}
 \frac{du_{N-1}}{dt} = \frac{D_u}{(\Delta x)^2} \left(2u_{N-2} - 2 u_{N-1}\right)
       -u_{N-1}v_{N-1}^2 + f(1 - u_{N-1}) \\
 \frac{dv_{N-1}}{dt} = \frac{D_v}{(\Delta x)^2} \left(2v_{N-2} - 2 v_{N-1}\right)
       + u_{N-1}v_{N-1}^2 - (f + k)v_{N-1}
 \end{split}\end{split}\]</div>
<p>Our complete system of <span class="math notranslate nohighlight">\(2N\)</span> ordinary differential equations is <a class="reference internal" href="#equation-interior">(1)</a>
for <span class="math notranslate nohighlight">\(k = 1, 2, \ldots, N-2\)</span>, along with <a class="reference internal" href="#equation-boundary0">(2)</a> and <a class="reference internal" href="#equation-boundaryl">(3)</a>.</p>
<p>We can now starting implementing this system in code.  We must combine
<span class="math notranslate nohighlight">\(\{u_k\}\)</span> and <span class="math notranslate nohighlight">\(\{v_k\}\)</span> into a single vector of length <span class="math notranslate nohighlight">\(2N\)</span>.
The two obvious choices are
<span class="math notranslate nohighlight">\(\{u_0, u_1, \ldots, u_{N-1}, v_0, v_1, \ldots, v_{N-1}\}\)</span>
and
<span class="math notranslate nohighlight">\(\{u_0, v_0, u_1, v_1, \ldots, u_{N-1}, v_{N-1}\}\)</span>.
Mathematically, it does not matter, but the choice affects how
efficiently <a class="reference internal" href="../reference/generated/scipy.integrate.odeint.html#scipy.integrate.odeint" title="scipy.integrate.odeint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odeint</span></code></a> can solve the system.  The reason is in how
the order affects the pattern of the nonzero elements of the Jacobian matrix.</p>
<p>When the variables are ordered
as <span class="math notranslate nohighlight">\(\{u_0, u_1, \ldots, u_{N-1}, v_0, v_1, \ldots, v_{N-1}\}\)</span>,
the pattern of nonzero elements of the Jacobian matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{smallmatrix}
   * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp;  * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp;  0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0  &amp;  0 &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0  &amp;  0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0  &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; *  &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; *  &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * \\
   * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp;  * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp;  * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp;  0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0  &amp;  0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; 0  &amp;  0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0  &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; *  &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; ) &amp; * &amp; * \\
\end{smallmatrix}\end{split}\]</div>
<p>The Jacobian pattern with variables interleaved
as <span class="math notranslate nohighlight">\(\{u_0, v_0, u_1, v_1, \ldots, u_{N-1}, v_{N-1}\}\)</span> is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{smallmatrix}
   * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   * &amp; * &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   * &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; * &amp; * &amp; * &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; * &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; * &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; * &amp; 0 &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; * &amp; * &amp; * &amp; 0 \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * &amp; 0 &amp; * \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; 0 &amp; * &amp; * \\
   0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; * &amp; * &amp; * \\
\end{smallmatrix}\end{split}\]</div>
<p>In both cases, there are just five nontrivial diagonals, but
when the variables are interleaved, the bandwidth is much
smaller.
That is, the main diagonal and the two diagonals immediately
above and the two immediately below the main diagonal
are the nonzero diagonals.
This is important, because the inputs <code class="docutils literal notranslate"><span class="pre">mu</span></code> and <code class="docutils literal notranslate"><span class="pre">ml</span></code>
of <a class="reference internal" href="../reference/generated/scipy.integrate.odeint.html#scipy.integrate.odeint" title="scipy.integrate.odeint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odeint</span></code></a> are the upper and lower bandwidths of the
Jacobian matrix.  When the variables are interleaved,
<code class="docutils literal notranslate"><span class="pre">mu</span></code> and <code class="docutils literal notranslate"><span class="pre">ml</span></code> are 2.  When the variables are stacked
with <span class="math notranslate nohighlight">\(\{v_k\}\)</span> following <span class="math notranslate nohighlight">\(\{u_k\}\)</span>, the upper
and lower bandwidths are <span class="math notranslate nohighlight">\(N\)</span>.</p>
<p>With that decision made, we can write the function that
implements the system of differential equations.</p>
<p>First, we define the functions for the source and reaction
terms of the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span> <span class="o">+</span> <span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>Next, we define the function that computes the right-hand side
of the system of differential equations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grayscott1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">Du</span><span class="p">,</span> <span class="n">Dv</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Differential equations for the 1-D Gray-Scott equations.</span>

<span class="sd">    The ODEs are derived using the method of lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The vectors u and v are interleaved in y.  We define</span>
    <span class="c1"># views of u and v by slicing y.</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># dydt is the return value of this function.</span>
    <span class="n">dydt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Just like u and v are views of the interleaved vectors</span>
    <span class="c1"># in y, dudt and dvdt are views of the interleaved output</span>
    <span class="c1"># vectors in dydt.</span>
    <span class="n">dudt</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dvdt</span> <span class="o">=</span> <span class="n">dydt</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Compute du/dt and dv/dt.  The end points and the interior points</span>
    <span class="c1"># are handled separately.</span>
    <span class="n">dudt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Du</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dudt</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Du</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dudt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>   <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>   <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Du</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dvdt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">H</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Dv</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dvdt</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Dv</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dvdt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="n">H</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>   <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>   <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Dv</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">dydt</span>
</pre></div>
</div>
<p>We won’t implement a function to compute the Jacobian, but we will tell
<a class="reference internal" href="../reference/generated/scipy.integrate.odeint.html#scipy.integrate.odeint" title="scipy.integrate.odeint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odeint</span></code></a> that the Jacobian matrix is banded.  This allows the underlying
solver (LSODA) to avoid computing values that it knows are zero.  For a large
system, this improves the performance significantly, as demonstrated in the
following ipython session.</p>
<p>First, we define the required inputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.024</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">0.055</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">Du</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">Dv</span> <span class="o">=</span> <span class="mf">0.005</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.025</span>
</pre></div>
</div>
<p>Time the computation without taking advantage of the banded structure
of the Jacobian matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">sola</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">grayscott1d</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">Du</span><span class="p">,</span> <span class="n">Dv</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span>
<span class="mi">1</span> <span class="n">loop</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">25.2</span> <span class="n">s</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
</div>
<p>Now set <code class="docutils literal notranslate"><span class="pre">ml=2</span></code> and <code class="docutils literal notranslate"><span class="pre">mu=2</span></code>, so <a class="reference internal" href="../reference/generated/scipy.integrate.odeint.html#scipy.integrate.odeint" title="scipy.integrate.odeint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odeint</span></code></a> knows that the Jacobian matrix
is banded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">solb</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">grayscott1d</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">Du</span><span class="p">,</span> <span class="n">Dv</span><span class="p">,</span> <span class="n">dx</span><span class="p">),</span> <span class="n">ml</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">191</span> <span class="n">ms</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
</div>
<p>That is quite a bit faster!</p>
<p>Let’s ensure that they have computed the same result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sola</span><span class="p">,</span> <span class="n">solb</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<dl class="citation">
<dt class="label" id="wpr"><span class="brackets"><a class="fn-backref" href="#id1">WPR</a></span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Romberg's_method">https://en.wikipedia.org/wiki/Romberg’s_method</a></p>
</dd>
<dt class="label" id="mol"><span class="brackets"><a class="fn-backref" href="#id2">MOL</a></span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Method_of_lines">https://en.wikipedia.org/wiki/Method_of_lines</a></p>
</dd>
</dl>
</section>
</section>
</section>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="special.html" title="previous page">Special functions (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.special</span></code>)</a>
    <a class='right-next' id="next-link" href="optimize.html" title="next page">Optimization (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.optimize</span></code>)</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2008-2021, The SciPy community.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.2.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>