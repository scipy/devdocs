
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Signal Processing (scipy.signal) &#8212; SciPy v1.15.0.dev Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Vibur" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyterlite_sphinx.css?v=ca70e7f1" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/scipy.css?v=6dd54bfa" />
    <link rel="stylesheet" type="text/css" href="../_static/try_examples.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=3d29109c"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=fe3c738c"></script>
    <script src="../_static/jupyterlite_sphinx.js?v=d6bdf5f8"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script data-domain="docs.scipy.org" defer="defer" src="https://views.scientific-python.org/js/script.js"></script>
    <script async="async" src="../_static/scipy-mathjax/MathJax.js?config=scipy-mathjax"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/signal';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://scipy.github.io/devdocs/_static/version_switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'development';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linear Algebra (scipy.linalg)" href="linalg.html" />
    <link rel="prev" title="Fourier Transforms (scipy.fft)" href="fft.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.15.0.dev" />
    <meta name="docbuild:last-update" content="Oct 24, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">SciPy</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipy.org/install/">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../building/index.html">
    Building from source
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipy/scipy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/SciPy_team" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipy.org/install/">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../building/index.html">
    Building from source
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipy/scipy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/SciPy_team" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links" aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="special.html">Special functions (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.special</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrate.html">Integration (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.integrate</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize.html">Optimization (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.optimize</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolate.html">Interpolation (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.interpolate</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">Fourier Transforms (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.fft</span></code>)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Signal Processing (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">Linear Algebra (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.linalg</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">Sparse Arrays (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.sparse</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="arpack.html">Sparse eigenvalue problems with ARPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="csgraph.html">Compressed Sparse Graph Routines (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.sparse.csgraph</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial.html">Spatial data structures and algorithms (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.spatial</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">Statistics (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ndimage.html">Multidimensional image processing (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.ndimage</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">File IO (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.io</span></code>)</a></li>
</ul>

  </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">SciPy User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Signal Processing (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal</span></code>)</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="signal-processing-scipy-signal">
<h1>Signal Processing (<a class="reference internal" href="../reference/signal.html#module-scipy.signal" title="scipy.signal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal</span></code></a>)<a class="headerlink" href="#signal-processing-scipy-signal" title="Link to this heading">#</a></h1>
<p>The signal processing toolbox currently contains some filtering
functions, a limited set of filter design tools, and a few B-spline
interpolation algorithms for 1- and 2-D data. While the
B-spline algorithms could technically be placed under the
interpolation category, they are included here because they only work
with equally-spaced data and make heavy use of filter-theory and
transfer-function formalism to provide a fast B-spline transform. To
understand this section, you will need to understand that a signal in
SciPy is an array of real or complex numbers.</p>
<section id="b-splines">
<span id="tutorial-signal-bsplines"></span><h2>B-splines<a class="headerlink" href="#b-splines" title="Link to this heading">#</a></h2>
<p>A B-spline is an approximation of a continuous function over a finite-
domain in terms of B-spline coefficients and knot points. If the knot-
points are equally spaced with spacing <span class="math notranslate nohighlight">\(\Delta x\)</span>, then the B-spline
approximation to a 1-D function is the finite-basis expansion.</p>
<div class="math notranslate nohighlight">
\[y\left(x\right)\approx\sum_{j}c_{j}\beta^{o}\left(\frac{x}{\Delta x}-j\right).\]</div>
<p>In two dimensions with knot-spacing <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta y\)</span>, the
function representation is</p>
<div class="math notranslate nohighlight">
\[z\left(x,y\right)\approx\sum_{j}\sum_{k}c_{jk}\beta^{o}\left(\frac{x}{\Delta x}-j\right)\beta^{o}\left(\frac{y}{\Delta y}-k\right).\]</div>
<p>In these expressions, <span class="math notranslate nohighlight">\(\beta^{o}\left(\cdot\right)\)</span> is the space-limited
B-spline basis function of order <span class="math notranslate nohighlight">\(o\)</span>. The requirement of equally-spaced
knot-points and equally-spaced data points, allows the development of fast
(inverse-filtering) algorithms for determining the coefficients, <span class="math notranslate nohighlight">\(c_{j}\)</span>,
from sample-values, <span class="math notranslate nohighlight">\(y_{n}\)</span>. Unlike the general spline interpolation
algorithms, these algorithms can quickly find the spline coefficients for large
images.</p>
<p>The advantage of representing a set of samples via B-spline basis
functions is that continuous-domain operators (derivatives, re-
sampling, integral, etc.), which assume that the data samples are drawn
from an underlying continuous function, can be computed with relative
ease from the spline coefficients. For example, the second derivative
of a spline is</p>
<div class="math notranslate nohighlight">
\[y{}^{\prime\prime}\left(x\right)=\frac{1}{\Delta x^{2}}\sum_{j}c_{j}\beta^{o\prime\prime}\left(\frac{x}{\Delta x}-j\right).\]</div>
<p>Using the property of B-splines that</p>
<div class="math notranslate nohighlight">
\[\frac{d^{2}\beta^{o}\left(w\right)}{dw^{2}}=\beta^{o-2}\left(w+1\right)-2\beta^{o-2}\left(w\right)+\beta^{o-2}\left(w-1\right),\]</div>
<p>it can be seen that</p>
<div class="math notranslate nohighlight">
\[y^{\prime\prime}\left(x\right)=\frac{1}{\Delta x^{2}}\sum_{j}c_{j}\left[\beta^{o-2}\left(\frac{x}{\Delta x}-j+1\right)-2\beta^{o-2}\left(\frac{x}{\Delta x}-j\right)+\beta^{o-2}\left(\frac{x}{\Delta x}-j-1\right)\right].\]</div>
<p>If <span class="math notranslate nohighlight">\(o=3\)</span>, then at the sample points:</p>
<div class="math notranslate nohighlight">
 \begin{eqnarray*} \Delta x^{2}\left.y^{\prime}\left(x\right)\right|_{x=n\Delta x} &amp; = &amp; \sum_{j}c_{j}\delta_{n-j+1}-2c_{j}\delta_{n-j}+c_{j}\delta_{n-j-1},\\  &amp; = &amp; c_{n+1}-2c_{n}+c_{n-1}.\end{eqnarray*}</div><p>Thus, the second-derivative signal can be easily calculated from the spline
fit. If desired, smoothing splines can be found to make the second derivative
less sensitive to random errors.</p>
<p>The savvy reader will have already noticed that the data samples are related
to the knot coefficients via a convolution operator, so that simple
convolution with the sampled B-spline function recovers the original data from
the spline coefficients. The output of convolutions can change depending on
how the boundaries are handled (this becomes increasingly more important as the
number of dimensions in the dataset increases). The algorithms relating to
B-splines in the signal-processing subpackage assume mirror-symmetric
boundary conditions. Thus, spline coefficients are computed based on that
assumption, and data-samples can be recovered exactly from the spline
coefficients by assuming them to be mirror-symmetric also.</p>
<p>Currently the package provides functions for determining second- and third-
order cubic spline coefficients from equally-spaced samples in one and two
dimensions (<a class="reference internal" href="../reference/generated/scipy.signal.qspline1d.html#scipy.signal.qspline1d" title="scipy.signal.qspline1d"><code class="xref py py-func docutils literal notranslate"><span class="pre">qspline1d</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.signal.qspline2d.html#scipy.signal.qspline2d" title="scipy.signal.qspline2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">qspline2d</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.signal.cspline1d.html#scipy.signal.cspline1d" title="scipy.signal.cspline1d"><code class="xref py py-func docutils literal notranslate"><span class="pre">cspline1d</span></code></a>,
<a class="reference internal" href="../reference/generated/scipy.signal.cspline2d.html#scipy.signal.cspline2d" title="scipy.signal.cspline2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">cspline2d</span></code></a>). For large <span class="math notranslate nohighlight">\(o\)</span>, the B-spline basis
function can be approximated well by a zero-mean Gaussian function with
standard-deviation equal to <span class="math notranslate nohighlight">\(\sigma_{o}=\left(o+1\right)/12\)</span> :</p>
<div class="math notranslate nohighlight">
\[\beta^{o}\left(x\right)\approx\frac{1}{\sqrt{2\pi\sigma_{o}^{2}}}\exp\left(-\frac{x^{2}}{2\sigma_{o}}\right).\]</div>
<p>A function to compute this Gaussian for arbitrary <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(o\)</span> is
also available ( <a class="reference internal" href="../reference/generated/scipy.signal.gauss_spline.html#scipy.signal.gauss_spline" title="scipy.signal.gauss_spline"><code class="xref py py-func docutils literal notranslate"><span class="pre">gauss_spline</span></code></a> ). The following code and figure use
spline-filtering to compute an edge-image (the second derivative of a smoothed
spline) of a raccoon’s face, which is an array returned by the command <a class="reference internal" href="../reference/generated/scipy.datasets.face.html#scipy.datasets.face" title="scipy.datasets.face"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.datasets.face</span></code></a>.
The command <a class="reference internal" href="../reference/generated/scipy.signal.sepfir2d.html#scipy.signal.sepfir2d" title="scipy.signal.sepfir2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">sepfir2d</span></code></a> was used to apply a separable 2-D FIR
filter with mirror-symmetric boundary conditions to the spline coefficients.
This function is ideally-suited for reconstructing samples from spline
coefficients and is faster than <a class="reference internal" href="../reference/generated/scipy.signal.convolve2d.html#scipy.signal.convolve2d" title="scipy.signal.convolve2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">convolve2d</span></code></a>, which convolves arbitrary
2-D filters and allows for choosing mirror-symmetric boundary
conditions.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span><span class="p">,</span> <span class="n">datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">face</span><span class="p">(</span><span class="n">gray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">derfilt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ck</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cspline2d</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deriv</span> <span class="o">=</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">sepfir2d</span><span class="p">(</span><span class="n">ck</span><span class="p">,</span> <span class="n">derfilt</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>
<span class="gp">... </span>         <span class="n">signal</span><span class="o">.</span><span class="n">sepfir2d</span><span class="p">(</span><span class="n">ck</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">derfilt</span><span class="p">))</span>
</pre></div>
</div>
<p>Alternatively, we could have done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">laplacian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">deriv2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">convolve2d</span><span class="p">(</span><span class="n">ck</span><span class="p">,</span><span class="n">laplacian</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span><span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;symm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is a normal grayscale photo of a raccoon climbing on a palm plant. The second plot has the 2-D spline filter applied to the photo and is completely grey except the edges of the photo have been emphasized, especially on the raccoon fur and palm fronds.&quot;" class="plot-directive" src="../_images/signal-1_00_00.png" />
</figure>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output of spline edge filter&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is a normal grayscale photo of a raccoon climbing on a palm plant. The second plot has the 2-D spline filter applied to the photo and is completely grey except the edges of the photo have been emphasized, especially on the raccoon fur and palm fronds.&quot;" class="plot-directive" src="../_images/signal-1_01_00.png" />
</figure>
</section>
<section id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Link to this heading">#</a></h2>
<p>Filtering is a generic name for any system that modifies an input
signal in some way. In SciPy, a signal can be thought of as a NumPy
array. There are different kinds of filters for different kinds of
operations. There are two broad kinds of filtering operations: linear
and non-linear. Linear filters can always be reduced to multiplication
of the flattened NumPy array by an appropriate matrix resulting in
another flattened NumPy array. Of course, this is not usually the best
way to compute the filter, as the matrices and vectors involved may be
huge. For example, filtering a <span class="math notranslate nohighlight">\(512 \times 512\)</span> image with this
method would require multiplication of a <span class="math notranslate nohighlight">\(512^2 \times 512^2\)</span>
matrix with a <span class="math notranslate nohighlight">\(512^2\)</span> vector. Just trying to store the
<span class="math notranslate nohighlight">\(512^2 \times 512^2\)</span> matrix using a standard NumPy array would
require <span class="math notranslate nohighlight">\(68,719,476,736\)</span> elements. At 4 bytes per element this
would require <span class="math notranslate nohighlight">\(256\textrm{GB}\)</span> of memory. In most applications,
most of the elements of this matrix are zero and a different method
for computing the output of the filter is employed.</p>
<section id="convolution-correlation">
<h3>Convolution/Correlation<a class="headerlink" href="#convolution-correlation" title="Link to this heading">#</a></h3>
<p>Many linear filters also have the property of shift-invariance. This
means that the filtering operation is the same at different locations
in the signal and it implies that the filtering matrix can be
constructed from knowledge of one row (or column) of the matrix alone.
In this case, the matrix multiplication can be accomplished using
Fourier transforms.</p>
<p>Let <span class="math notranslate nohighlight">\(x\left[n\right]\)</span> define a 1-D signal indexed by the
integer <span class="math notranslate nohighlight">\(n.\)</span> Full convolution of two 1-D signals can be
expressed as</p>
<div class="math notranslate nohighlight">
\[y\left[n\right]=\sum_{k=-\infty}^{\infty}x\left[k\right]h\left[n-k\right].\]</div>
<p>This equation can only be implemented directly if we limit the
sequences to finite-support sequences that can be stored in a
computer, choose <span class="math notranslate nohighlight">\(n=0\)</span> to be the starting point of both
sequences, let <span class="math notranslate nohighlight">\(K+1\)</span> be that value for which
<span class="math notranslate nohighlight">\(x\left[n\right]=0\)</span> for all <span class="math notranslate nohighlight">\(n\geq K+1\)</span> and <span class="math notranslate nohighlight">\(M+1\)</span> be
that value for which <span class="math notranslate nohighlight">\(h\left[n\right]=0\)</span> for all <span class="math notranslate nohighlight">\(n\geq M+1\)</span>,
then the discrete convolution expression is</p>
<div class="math notranslate nohighlight">
\[y\left[n\right]=\sum_{k=\max\left(n-M,0\right)}^{\min\left(n,K\right)}x\left[k\right]h\left[n-k\right].\]</div>
<p>For convenience, assume <span class="math notranslate nohighlight">\(K\geq M.\)</span> Then, more explicitly, the output of
this operation is</p>
<div class="math notranslate nohighlight">
 \begin{eqnarray*} y\left[0\right] &amp; = &amp; x\left[0\right]h\left[0\right]\\ y\left[1\right] &amp; = &amp; x\left[0\right]h\left[1\right]+x\left[1\right]h\left[0\right]\\ y\left[2\right] &amp; = &amp; x\left[0\right]h\left[2\right]+x\left[1\right]h\left[1\right]+x\left[2\right]h\left[0\right]\\ \vdots &amp; \vdots &amp; \vdots\\ y\left[M\right] &amp; = &amp; x\left[0\right]h\left[M\right]+x\left[1\right]h\left[M-1\right]+\cdots+x\left[M\right]h\left[0\right]\\ y\left[M+1\right] &amp; = &amp; x\left[1\right]h\left[M\right]+x\left[2\right]h\left[M-1\right]+\cdots+x\left[M+1\right]h\left[0\right]\\ \vdots &amp; \vdots &amp; \vdots\\ y\left[K\right] &amp; = &amp; x\left[K-M\right]h\left[M\right]+\cdots+x\left[K\right]h\left[0\right]\\ y\left[K+1\right] &amp; = &amp; x\left[K+1-M\right]h\left[M\right]+\cdots+x\left[K\right]h\left[1\right]\\ \vdots &amp; \vdots &amp; \vdots\\ y\left[K+M-1\right] &amp; = &amp; x\left[K-1\right]h\left[M\right]+x\left[K\right]h\left[M-1\right]\\ y\left[K+M\right] &amp; = &amp; x\left[K\right]h\left[M\right].\end{eqnarray*}</div><p>Thus, the full discrete convolution of two finite sequences of lengths
<span class="math notranslate nohighlight">\(K+1\)</span> and <span class="math notranslate nohighlight">\(M+1\)</span>, respectively, results in a finite sequence of length
<span class="math notranslate nohighlight">\(K+M+1=\left(K+1\right)+\left(M+1\right)-1.\)</span></p>
<p>1-D convolution is implemented in SciPy with the function
<a class="reference internal" href="../reference/generated/scipy.signal.convolve.html#scipy.signal.convolve" title="scipy.signal.convolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">convolve</span></code></a>. This function takes as inputs the signals <span class="math notranslate nohighlight">\(x,\)</span>
<span class="math notranslate nohighlight">\(h\)</span>, and two optional flags ‘mode’ and ‘method’, and returns the signal
<span class="math notranslate nohighlight">\(y.\)</span></p>
<p>The first optional flag, ‘mode’, allows for the specification of which part of the
output signal to return. The default value of ‘full’ returns the entire signal.
If the flag has a value of ‘same’, then only the middle <span class="math notranslate nohighlight">\(K\)</span> values are
returned, starting at <span class="math notranslate nohighlight">\(y\left[\left\lfloor \frac{M-1}{2}\right\rfloor
\right]\)</span>, so that the output has the same length as the first input. If the flag
has a value of ‘valid’, then only the middle
<span class="math notranslate nohighlight">\(K-M+1=\left(K+1\right)-\left(M+1\right)+1\)</span> output values are returned,
where <span class="math notranslate nohighlight">\(z\)</span> depends on all of the values of the smallest input from
<span class="math notranslate nohighlight">\(h\left[0\right]\)</span> to <span class="math notranslate nohighlight">\(h\left[M\right].\)</span> In other words, only the
values <span class="math notranslate nohighlight">\(y\left[M\right]\)</span> to <span class="math notranslate nohighlight">\(y\left[K\right]\)</span> inclusive are
returned.</p>
<p>The second optional flag, ‘method’, determines how the convolution is computed,
either through the Fourier transform approach with <a class="reference internal" href="../reference/generated/scipy.signal.fftconvolve.html#scipy.signal.fftconvolve" title="scipy.signal.fftconvolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">fftconvolve</span></code></a> or
through the direct method. By default, it selects the expected faster method.
The Fourier transform method has order <span class="math notranslate nohighlight">\(O(N\log N)\)</span>, while the direct
method has order <span class="math notranslate nohighlight">\(O(N^2)\)</span>. Depending on the big O constant and the value
of <span class="math notranslate nohighlight">\(N\)</span>, one of these two methods may be faster. The default value, ‘auto’,
performs a rough calculation and chooses the expected faster method, while the
values ‘direct’ and ‘fft’ force computation with the other two methods.</p>
<p>The code below shows a simple example for convolution of 2 sequences:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="go">array([ 0.,  1.,  2.,  3.,  0.,  0.,  0.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
<span class="go">array([ 2.,  3.,  0.])</span>
</pre></div>
</div>
<p>This same function <a class="reference internal" href="../reference/generated/scipy.signal.convolve.html#scipy.signal.convolve" title="scipy.signal.convolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">convolve</span></code></a> can actually take N-D
arrays as inputs and will return the N-D convolution of the
two arrays, as is shown in the code example below. The same input flags are
available for that case as well.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="go">array([[ 1.,  1.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="go">       [ 1.,  1.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.,  1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.,  1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.,  0.,  0.,  0.]])</span>
</pre></div>
</div>
<p>Correlation is very similar to convolution except that the minus sign
becomes a plus sign. Thus,</p>
<div class="math notranslate nohighlight">
\[w\left[n\right]=\sum_{k=-\infty}^{\infty}y\left[k\right]x\left[n+k\right],\]</div>
<p>is the (cross) correlation of the signals <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(x.\)</span> For
finite-length signals with <span class="math notranslate nohighlight">\(y\left[n\right]=0\)</span> outside of the range
<span class="math notranslate nohighlight">\(\left[0,K\right]\)</span> and <span class="math notranslate nohighlight">\(x\left[n\right]=0\)</span> outside of the range
<span class="math notranslate nohighlight">\(\left[0,M\right],\)</span> the summation can simplify to</p>
<div class="math notranslate nohighlight">
\[w\left[n\right]=\sum_{k=\max\left(0,-n\right)}^{\min\left(K,M-n\right)}y\left[k\right]x\left[n+k\right].\]</div>
<p>Assuming again that <span class="math notranslate nohighlight">\(K\geq M\)</span>, this is</p>
<div class="math notranslate nohighlight">
 \begin{eqnarray*} w\left[-K\right] &amp; = &amp; y\left[K\right]x\left[0\right]\\ w\left[-K+1\right] &amp; = &amp; y\left[K-1\right]x\left[0\right]+y\left[K\right]x\left[1\right]\\ \vdots &amp; \vdots &amp; \vdots\\ w\left[M-K\right] &amp; = &amp; y\left[K-M\right]x\left[0\right]+y\left[K-M+1\right]x\left[1\right]+\cdots+y\left[K\right]x\left[M\right]\\ w\left[M-K+1\right] &amp; = &amp; y\left[K-M-1\right]x\left[0\right]+\cdots+y\left[K-1\right]x\left[M\right]\\ \vdots &amp; \vdots &amp; \vdots\\ w\left[-1\right] &amp; = &amp; y\left[1\right]x\left[0\right]+y\left[2\right]x\left[1\right]+\cdots+y\left[M+1\right]x\left[M\right]\\ w\left[0\right] &amp; = &amp; y\left[0\right]x\left[0\right]+y\left[1\right]x\left[1\right]+\cdots+y\left[M\right]x\left[M\right]\\ w\left[1\right] &amp; = &amp; y\left[0\right]x\left[1\right]+y\left[1\right]x\left[2\right]+\cdots+y\left[M-1\right]x\left[M\right]\\ w\left[2\right] &amp; = &amp; y\left[0\right]x\left[2\right]+y\left[1\right]x\left[3\right]+\cdots+y\left[M-2\right]x\left[M\right]\\ \vdots &amp; \vdots &amp; \vdots\\ w\left[M-1\right] &amp; = &amp; y\left[0\right]x\left[M-1\right]+y\left[1\right]x\left[M\right]\\ w\left[M\right] &amp; = &amp; y\left[0\right]x\left[M\right].\end{eqnarray*}</div><p>The SciPy function <a class="reference internal" href="../reference/generated/scipy.signal.correlate.html#scipy.signal.correlate" title="scipy.signal.correlate"><code class="xref py py-func docutils literal notranslate"><span class="pre">correlate</span></code></a> implements this operation. Equivalent
flags are available for this operation to return the full <span class="math notranslate nohighlight">\(K+M+1\)</span> length
sequence (‘full’) or a sequence with the same size as the largest sequence
starting at <span class="math notranslate nohighlight">\(w\left[-K+\left\lfloor \frac{M-1}{2}\right\rfloor \right]\)</span>
(‘same’) or a sequence where the values depend on all the values of the
smallest sequence (‘valid’). This final option returns the <span class="math notranslate nohighlight">\(K-M+1\)</span>
values <span class="math notranslate nohighlight">\(w\left[M-K\right]\)</span> to <span class="math notranslate nohighlight">\(w\left[0\right]\)</span> inclusive.</p>
<p>The function <a class="reference internal" href="../reference/generated/scipy.signal.correlate.html#scipy.signal.correlate" title="scipy.signal.correlate"><code class="xref py py-func docutils literal notranslate"><span class="pre">correlate</span></code></a> can also take arbitrary N-D arrays as input
and return the N-D convolution of the two arrays on output.</p>
<p>When <span class="math notranslate nohighlight">\(N=2,\)</span> <a class="reference internal" href="../reference/generated/scipy.signal.correlate.html#scipy.signal.correlate" title="scipy.signal.correlate"><code class="xref py py-func docutils literal notranslate"><span class="pre">correlate</span></code></a> and/or <a class="reference internal" href="../reference/generated/scipy.signal.convolve.html#scipy.signal.convolve" title="scipy.signal.convolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">convolve</span></code></a> can be used
to construct arbitrary image filters to perform actions such as blurring,
enhancing, and edge-detection for an image.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span><span class="p">,</span> <span class="n">datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">face</span><span class="p">(</span><span class="n">gray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="p">[</span><span class="mi">49</span><span class="p">][</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image_new</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is the familiar photo of a raccoon climbing on a palm. The second plot has the FIR filter applied and has the two copies of the photo superimposed due to the twin peaks manually set in the filter kernel definition.&quot;" class="plot-directive" src="../_images/signal-2_00_00.png" />
</figure>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_new</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filtered image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is the familiar photo of a raccoon climbing on a palm. The second plot has the FIR filter applied and has the two copies of the photo superimposed due to the twin peaks manually set in the filter kernel definition.&quot;" class="plot-directive" src="../_images/signal-2_01_00.png" />
</figure>
<p>Calculating the convolution in the time domain as above is mainly used for
filtering when one of the signals is much smaller than the other ( <span class="math notranslate nohighlight">\(K\gg
M\)</span> ), otherwise linear filtering is more efficiently calculated in the
frequency domain provided by the function <a class="reference internal" href="../reference/generated/scipy.signal.fftconvolve.html#scipy.signal.fftconvolve" title="scipy.signal.fftconvolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">fftconvolve</span></code></a>. By default,
<a class="reference internal" href="../reference/generated/scipy.signal.convolve.html#scipy.signal.convolve" title="scipy.signal.convolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">convolve</span></code></a> estimates the fastest method using <a class="reference internal" href="../reference/generated/scipy.signal.choose_conv_method.html#scipy.signal.choose_conv_method" title="scipy.signal.choose_conv_method"><code class="xref py py-func docutils literal notranslate"><span class="pre">choose_conv_method</span></code></a>.</p>
<p>If the filter function <span class="math notranslate nohighlight">\(w[n,m]\)</span> can be factored according to</p>
<div class="math notranslate nohighlight">
\[h[n, m] = h_1[n] h_2[m],\]</div>
<p>convolution can be calculated by means of the function <a class="reference internal" href="../reference/generated/scipy.signal.sepfir2d.html#scipy.signal.sepfir2d" title="scipy.signal.sepfir2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">sepfir2d</span></code></a>. As an
example, we consider a Gaussian filter <a class="reference internal" href="../reference/generated/scipy.signal.windows.gaussian.html#scipy.signal.windows.gaussian" title="scipy.signal.windows.gaussian"><code class="xref py py-func docutils literal notranslate"><span class="pre">gaussian</span></code></a></p>
<div class="math notranslate nohighlight">
\[h[n, m] \propto e^{-x^2-y^2} = e^{-x^2} e^{-y^2},\]</div>
<p>which is often used for blurring.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span><span class="p">,</span> <span class="n">datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">ascent</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image_new</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sepfir2d</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is a grayscale photo of two people climbing a wooden staircase taken from below. The second plot has the 2-D gaussian FIR window applied and appears very blurry. You can still tell it's a photo but the subject is ambiguous.&quot;" class="plot-directive" src="../_images/signal-3_00_00.png" />
</figure>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_new</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filtered image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is a grayscale photo of two people climbing a wooden staircase taken from below. The second plot has the 2-D gaussian FIR window applied and appears very blurry. You can still tell it's a photo but the subject is ambiguous.&quot;" class="plot-directive" src="../_images/signal-3_01_00.png" />
</figure>
</section>
<section id="difference-equation-filtering">
<h3>Difference-equation filtering<a class="headerlink" href="#difference-equation-filtering" title="Link to this heading">#</a></h3>
<p>A general class of linear 1-D filters (that includes convolution
filters) are filters described by the difference equation</p>
<div class="math notranslate nohighlight">
\[\sum_{k=0}^{N}a_{k}y\left[n-k\right]=\sum_{k=0}^{M}b_{k}x\left[n-k\right],\]</div>
<p>where <span class="math notranslate nohighlight">\(x\left[n\right]\)</span> is the input sequence and
<span class="math notranslate nohighlight">\(y\left[n\right]\)</span> is the output sequence. If we assume initial rest so
that <span class="math notranslate nohighlight">\(y\left[n\right]=0\)</span> for <span class="math notranslate nohighlight">\(n&lt;0\)</span>, then this kind of filter can
be implemented using convolution. However, the convolution filter sequence
<span class="math notranslate nohighlight">\(h\left[n\right]\)</span> could be infinite if <span class="math notranslate nohighlight">\(a_{k}\neq0\)</span> for
<span class="math notranslate nohighlight">\(k\geq1.\)</span> In addition, this general class of linear filter allows
initial conditions to be placed on <span class="math notranslate nohighlight">\(y\left[n\right]\)</span> for <span class="math notranslate nohighlight">\(n&lt;0\)</span>
resulting in a filter that cannot be expressed using convolution.</p>
<p>The difference equation filter can be thought of as finding
<span class="math notranslate nohighlight">\(y\left[n\right]\)</span> recursively in terms of its previous values</p>
<div class="math notranslate nohighlight">
\[a_{0}y\left[n\right]=-a_{1}y\left[n-1\right]-\cdots-a_{N}y\left[n-N\right]+\cdots+b_{0}x\left[n\right]+\cdots+b_{M}x\left[n-M\right].\]</div>
<p>Often, <span class="math notranslate nohighlight">\(a_{0}=1\)</span> is chosen for normalization. The implementation in SciPy
of this general difference equation filter is a little more complicated than
would be implied by the previous equation. It is implemented so that only one
signal needs to be delayed. The actual implementation equations are (assuming
<span class="math notranslate nohighlight">\(a_{0}=1\)</span> ):</p>
<div class="math notranslate nohighlight">
 \begin{eqnarray*} y\left[n\right] &amp; = &amp; b_{0}x\left[n\right]+z_{0}\left[n-1\right]\\ z_{0}\left[n\right] &amp; = &amp; b_{1}x\left[n\right]+z_{1}\left[n-1\right]-a_{1}y\left[n\right]\\ z_{1}\left[n\right] &amp; = &amp; b_{2}x\left[n\right]+z_{2}\left[n-1\right]-a_{2}y\left[n\right]\\ \vdots &amp; \vdots &amp; \vdots\\ z_{K-2}\left[n\right] &amp; = &amp; b_{K-1}x\left[n\right]+z_{K-1}\left[n-1\right]-a_{K-1}y\left[n\right]\\ z_{K-1}\left[n\right] &amp; = &amp; b_{K}x\left[n\right]-a_{K}y\left[n\right],\end{eqnarray*}</div><p>where <span class="math notranslate nohighlight">\(K=\max\left(N,M\right).\)</span> Note that <span class="math notranslate nohighlight">\(b_{K}=0\)</span> if <span class="math notranslate nohighlight">\(K&gt;M\)</span>
and <span class="math notranslate nohighlight">\(a_{K}=0\)</span> if <span class="math notranslate nohighlight">\(K&gt;N.\)</span> In this way, the output at time <span class="math notranslate nohighlight">\(n\)</span>
depends only on the input at time <span class="math notranslate nohighlight">\(n\)</span> and the value of <span class="math notranslate nohighlight">\(z_{0}\)</span> at
the previous time. This can always be calculated as long as the <span class="math notranslate nohighlight">\(K\)</span>
values <span class="math notranslate nohighlight">\(z_{0}\left[n-1\right]\ldots z_{K-1}\left[n-1\right]\)</span> are
computed and stored at each time step.</p>
<p>The difference-equation filter is called using the command <a class="reference internal" href="../reference/generated/scipy.signal.lfilter.html#scipy.signal.lfilter" title="scipy.signal.lfilter"><code class="xref py py-func docutils literal notranslate"><span class="pre">lfilter</span></code></a> in
SciPy. This command takes as inputs the vector <span class="math notranslate nohighlight">\(b,\)</span> the vector,
<span class="math notranslate nohighlight">\(a,\)</span> a signal <span class="math notranslate nohighlight">\(x\)</span> and returns the vector <span class="math notranslate nohighlight">\(y\)</span> (the same
length as <span class="math notranslate nohighlight">\(x\)</span> ) computed using the equation given above. If <span class="math notranslate nohighlight">\(x\)</span> is
N-D, then the filter is computed along the axis provided.
If desired, initial conditions providing the values of
<span class="math notranslate nohighlight">\(z_{0}\left[-1\right]\)</span> to <span class="math notranslate nohighlight">\(z_{K-1}\left[-1\right]\)</span> can be provided
or else it will be assumed that they are all zero. If initial conditions are
provided, then the final conditions on the intermediate variables are also
returned. These could be used, for example, to restart the calculation in the
same state.</p>
<p>Sometimes, it is more convenient to express the initial conditions in terms of
the signals <span class="math notranslate nohighlight">\(x\left[n\right]\)</span> and <span class="math notranslate nohighlight">\(y\left[n\right].\)</span> In other
words, perhaps you have the values of <span class="math notranslate nohighlight">\(x\left[-M\right]\)</span> to
<span class="math notranslate nohighlight">\(x\left[-1\right]\)</span> and the values of <span class="math notranslate nohighlight">\(y\left[-N\right]\)</span> to
<span class="math notranslate nohighlight">\(y\left[-1\right]\)</span> and would like to determine what values of
<span class="math notranslate nohighlight">\(z_{m}\left[-1\right]\)</span> should be delivered as initial conditions to the
difference-equation filter. It is not difficult to show that, for <span class="math notranslate nohighlight">\(0\leq
m&lt;K,\)</span></p>
<div class="math notranslate nohighlight">
\[z_{m}\left[n\right]=\sum_{p=0}^{K-m-1}\left(b_{m+p+1}x\left[n-p\right]-a_{m+p+1}y\left[n-p\right]\right).\]</div>
<p>Using this formula, we can find the initial-condition vector
<span class="math notranslate nohighlight">\(z_{0}\left[-1\right]\)</span> to <span class="math notranslate nohighlight">\(z_{K-1}\left[-1\right]\)</span> given initial
conditions on <span class="math notranslate nohighlight">\(y\)</span> (and <span class="math notranslate nohighlight">\(x\)</span> ). The command <a class="reference internal" href="../reference/generated/scipy.signal.lfiltic.html#scipy.signal.lfiltic" title="scipy.signal.lfiltic"><code class="xref py py-func docutils literal notranslate"><span class="pre">lfiltic</span></code></a> performs
this function.</p>
<p>As an example, consider the following system:</p>
<div class="math notranslate nohighlight">
\[y[n] = \frac{1}{2} x[n] + \frac{1}{4} x[n-1] + \frac{1}{3} y[n-1]\]</div>
<p>The code calculates the signal <span class="math notranslate nohighlight">\(y[n]\)</span> for a given signal <span class="math notranslate nohighlight">\(x[n]\)</span>;
first for initial conditions <span class="math notranslate nohighlight">\(y[-1] = 0\)</span> (default case), then for
<span class="math notranslate nohighlight">\(y[-1] = 2\)</span> by means of <a class="reference internal" href="../reference/generated/scipy.signal.lfiltic.html#scipy.signal.lfiltic" title="scipy.signal.lfiltic"><code class="xref py py-func docutils literal notranslate"><span class="pre">lfiltic</span></code></a>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">array([0.5, 0.41666667, 0.13888889, 0.0462963])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zi</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfiltic</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mf">2.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="o">=</span><span class="n">zi</span><span class="p">)</span>
<span class="go">(array([ 1.16666667,  0.63888889,  0.21296296,  0.07098765]), array([0.02366]))</span>
</pre></div>
</div>
<p>Note that the output signal <span class="math notranslate nohighlight">\(y[n]\)</span> has the same length as the length as
the input signal <span class="math notranslate nohighlight">\(x[n]\)</span>.</p>
<section id="analysis-of-linear-systems">
<h4>Analysis of Linear Systems<a class="headerlink" href="#analysis-of-linear-systems" title="Link to this heading">#</a></h4>
<p>Linear system described a linear-difference equation can be fully described by
the coefficient vectors <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> as was done above; an alternative
representation is to provide a factor <span class="math notranslate nohighlight">\(k\)</span>, <span class="math notranslate nohighlight">\(N_z\)</span> zeros <span class="math notranslate nohighlight">\(z_k\)</span>
and <span class="math notranslate nohighlight">\(N_p\)</span> poles <span class="math notranslate nohighlight">\(p_k\)</span>, respectively, to describe the system by
means of its transfer function <span class="math notranslate nohighlight">\(H(z)\)</span>, according to</p>
<div class="math notranslate nohighlight">
\[H(z) = k \frac{ (z-z_1)(z-z_2)...(z-z_{N_z})}{ (z-p_1)(z-p_2)...(z-p_{N_p})}.\]</div>
<p>This alternative representation can be obtained with the scipy function
<a class="reference internal" href="../reference/generated/scipy.signal.tf2zpk.html#scipy.signal.tf2zpk" title="scipy.signal.tf2zpk"><code class="xref py py-func docutils literal notranslate"><span class="pre">tf2zpk</span></code></a>; the inverse is provided by <a class="reference internal" href="../reference/generated/scipy.signal.zpk2tf.html#scipy.signal.zpk2tf" title="scipy.signal.zpk2tf"><code class="xref py py-func docutils literal notranslate"><span class="pre">zpk2tf</span></code></a>.</p>
<p>For the above example we have</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="go">(array([-0.5]), array([ 0.33333333]), 0.5)</span>
</pre></div>
</div>
<p>i.e., the system has a zero at <span class="math notranslate nohighlight">\(z=-1/2\)</span> and a pole at <span class="math notranslate nohighlight">\(z=1/3\)</span>.</p>
<p>The scipy function <a class="reference internal" href="../reference/generated/scipy.signal.freqz.html#scipy.signal.freqz" title="scipy.signal.freqz"><code class="xref py py-func docutils literal notranslate"><span class="pre">freqz</span></code></a> allows calculation of the frequency response
of a system described by the coefficients <span class="math notranslate nohighlight">\(a_k\)</span> and <span class="math notranslate nohighlight">\(b_k\)</span>. See the
help of the <a class="reference internal" href="../reference/generated/scipy.signal.freqz.html#scipy.signal.freqz" title="scipy.signal.freqz"><code class="xref py py-func docutils literal notranslate"><span class="pre">freqz</span></code></a> function for a comprehensive example.</p>
</section>
</section>
<section id="filter-design">
<h3>Filter Design<a class="headerlink" href="#filter-design" title="Link to this heading">#</a></h3>
<p>Time-discrete filters can be classified into finite response (FIR) filters and
infinite response (IIR) filters. FIR filters can provide a linear phase
response, whereas IIR filters cannot. SciPy provides functions
for designing both types of filters.</p>
<section id="fir-filter">
<h4>FIR Filter<a class="headerlink" href="#fir-filter" title="Link to this heading">#</a></h4>
<p>The function <a class="reference internal" href="../reference/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="scipy.signal.firwin"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin</span></code></a> designs filters according to the window method.
Depending on the provided arguments, the function returns different filter
types (e.g., low-pass, band-pass…).</p>
<p>The example below designs a low-pass and a band-stop filter, respectively.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Digital filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h1</span><span class="p">)),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h2</span><span class="p">)),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude Response (dB)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/sample)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays an X-Y plot with the amplitude response on the Y axis vs frequency on the X axis. The first (low-pass) trace in blue starts with a pass-band at 0 dB and curves down around halfway through with some ripple in the stop-band about 80 dB down. The second (band-stop) trace in red starts and ends at 0 dB, but the middle third is down about 60 dB from the peak with some ripple where the filter would suppress a signal.&quot;" class="plot-directive" src="../_images/signal-4.png" />
</figure>
<p>Note that <a class="reference internal" href="../reference/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="scipy.signal.firwin"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin</span></code></a> uses, per default, a normalized frequency defined such
that the value <span class="math notranslate nohighlight">\(1\)</span> corresponds to the Nyquist frequency, whereas the
function <a class="reference internal" href="../reference/generated/scipy.signal.freqz.html#scipy.signal.freqz" title="scipy.signal.freqz"><code class="xref py py-func docutils literal notranslate"><span class="pre">freqz</span></code></a> is defined such that the value <span class="math notranslate nohighlight">\(\pi\)</span> corresponds
to the Nyquist frequency.</p>
<p>The function <a class="reference internal" href="../reference/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="scipy.signal.firwin2"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin2</span></code></a> allows design of almost arbitrary frequency
responses by specifying an array of corner frequencies and corresponding
gains, respectively.</p>
<p>The example below designs a filter with such an arbitrary amplitude response.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin2</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Digital filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Digital filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude Response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/sample)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays an X-Y plot with amplitude response on the Y axis vs frequency on the X axis. A single trace forms a shape similar to a heartbeat signal.&quot;" class="plot-directive" src="../_images/signal-5.png" />
</figure>
<p>Note the linear scaling of the y-axis and the different definition of the
Nyquist frequency in <a class="reference internal" href="../reference/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="scipy.signal.firwin2"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin2</span></code></a> and <a class="reference internal" href="../reference/generated/scipy.signal.freqz.html#scipy.signal.freqz" title="scipy.signal.freqz"><code class="xref py py-func docutils literal notranslate"><span class="pre">freqz</span></code></a> (as explained above).</p>
</section>
<section id="iir-filter">
<h4>IIR Filter<a class="headerlink" href="#iir-filter" title="Link to this heading">#</a></h4>
<p>SciPy provides two functions to directly design IIR <a class="reference internal" href="../reference/generated/scipy.signal.iirdesign.html#scipy.signal.iirdesign" title="scipy.signal.iirdesign"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirdesign</span></code></a> and
<a class="reference internal" href="../reference/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="scipy.signal.iirfilter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirfilter</span></code></a>, where the filter type (e.g., elliptic) is passed as an
argument and several more filter design functions for specific filter types,
e.g., <a class="reference internal" href="../reference/generated/scipy.signal.ellip.html#scipy.signal.ellip" title="scipy.signal.ellip"><code class="xref py py-func docutils literal notranslate"><span class="pre">ellip</span></code></a>.</p>
<p>The example below designs an elliptic low-pass filter with defined pass-band
and stop-band ripple, respectively. Note the much lower filter order (order 4)
compared with the FIR filters from the examples above in order to reach the same
stop-band attenuation of <span class="math notranslate nohighlight">\(\approx 60\)</span> dB.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Wn</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rp</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">rs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;lowpass&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;ellip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Digital filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Digital filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude Response [dB]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/sample)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code generates an X-Y plot with amplitude response on the Y axis vs Frequency on the X axis. A single trace shows a smooth low-pass filter with the left third passband near 0 dB. The right two-thirds are about 60 dB down with two sharp narrow valleys dipping down to -100 dB.&quot;" class="plot-directive" src="../_images/signal-6.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important to note that the cutoffs for <a class="reference internal" href="../reference/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="scipy.signal.firwin"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin</span></code></a> and <a class="reference internal" href="../reference/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="scipy.signal.iirfilter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirfilter</span></code></a>
are defined differently. For <a class="reference internal" href="../reference/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="scipy.signal.firwin"><code class="xref py py-func docutils literal notranslate"><span class="pre">firwin</span></code></a>, the cutoff-frequency is at
half-amplitude (i.e. -6dB). For <a class="reference internal" href="../reference/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="scipy.signal.iirfilter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirfilter</span></code></a>, the cutoff is at half-power
(i.e. -3dB).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span> <span class="k">as</span> <span class="n">sig</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">,</span> <span class="n">h_fft</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h_amp</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_fft</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h_amp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;FIR&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">iirfilter</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">,</span> <span class="n">h_fft</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h_amp</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_fft</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h_amp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;IIR&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">2100</span><span class="p">,</span> <span class="mi">2900</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Amplitude Response [dB]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code generates an example plot displaying the differences in cutoff frequency between FIR and IIR filters. FIR filters have a cutoff frequency at half-amplitude, while IIR filter cutoffs are at half-power.&quot;" class="plot-directive" src="../_images/signal-7.png" />
</figure>
</div>
</section>
<section id="filter-coefficients">
<h4>Filter Coefficients<a class="headerlink" href="#filter-coefficients" title="Link to this heading">#</a></h4>
<p>Filter coefficients can be stored in several different formats:</p>
<ul class="simple">
<li><p>‘ba’ or ‘tf’ = transfer function coefficients</p></li>
<li><p>‘zpk’ = zeros, poles, and overall gain</p></li>
<li><p>‘ss’ = state-space system representation</p></li>
<li><p>‘sos’ = transfer function coefficients of second-order sections</p></li>
</ul>
<p>Functions, such as <a class="reference internal" href="../reference/generated/scipy.signal.tf2zpk.html#scipy.signal.tf2zpk" title="scipy.signal.tf2zpk"><code class="xref py py-func docutils literal notranslate"><span class="pre">tf2zpk</span></code></a> and <a class="reference internal" href="../reference/generated/scipy.signal.zpk2ss.html#scipy.signal.zpk2ss" title="scipy.signal.zpk2ss"><code class="xref py py-func docutils literal notranslate"><span class="pre">zpk2ss</span></code></a>, can convert between them.</p>
<section id="transfer-function-representation">
<h5>Transfer function representation<a class="headerlink" href="#transfer-function-representation" title="Link to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">ba</span></code> or <code class="docutils literal notranslate"><span class="pre">tf</span></code> format is a 2-tuple <code class="docutils literal notranslate"><span class="pre">(b,</span> <span class="pre">a)</span></code> representing a transfer
function, where <em class="xref py py-obj">b</em> is a length <code class="docutils literal notranslate"><span class="pre">M+1</span></code> array of coefficients of the <em class="xref py py-obj">M</em>-order
numerator polynomial, and <em class="xref py py-obj">a</em> is a length <code class="docutils literal notranslate"><span class="pre">N+1</span></code> array of coefficients of the
<em class="xref py py-obj">N</em>-order denominator, as positive, descending powers of the transfer function
variable. So the tuple of <span class="math notranslate nohighlight">\(b = [b_0, b_1, ..., b_M]\)</span> and
<span class="math notranslate nohighlight">\(a =[a_0, a_1, ..., a_N]\)</span> can represent an analog filter of the form:</p>
<div class="math notranslate nohighlight">
\[H(s) = \frac
{b_0 s^M + b_1 s^{(M-1)} + \cdots + b_M}
{a_0 s^N + a_1 s^{(N-1)} + \cdots + a_N}
= \frac
{\sum_{i=0}^M b_i s^{(M-i)}}
{\sum_{i=0}^N a_i s^{(N-i)}}\]</div>
<p>or a discrete-time filter of the form:</p>
<div class="math notranslate nohighlight">
\[H(z) = \frac
{b_0 z^M + b_1 z^{(M-1)} + \cdots + b_M}
{a_0 z^N + a_1 z^{(N-1)} + \cdots + a_N}
= \frac
{\sum_{i=0}^M b_i z^{(M-i)}}
{\sum_{i=0}^N a_i z^{(N-i)}}.\]</div>
<p>This “positive powers” form is found more commonly in controls
engineering.  If <em class="xref py py-obj">M</em> and <em class="xref py py-obj">N</em> are equal (which is true for all filters
generated by the bilinear transform), then this happens to be equivalent
to the “negative powers” discrete-time form preferred in DSP:</p>
<div class="math notranslate nohighlight">
\[H(z) = \frac
{b_0 + b_1 z^{-1} + \cdots + b_M z^{-M}}
{a_0 + a_1 z^{-1} + \cdots + a_N z^{-N}}
= \frac
{\sum_{i=0}^M b_i z^{-i}}
{\sum_{i=0}^N a_i z^{-i}}.\]</div>
<p>Although this is true for common filters, remember that this is not true
in the general case. If <em class="xref py py-obj">M</em> and <em class="xref py py-obj">N</em> are not equal, the discrete-time
transfer function coefficients must first be converted to the “positive
powers” form before finding the poles and zeros.</p>
<p>This representation suffers from numerical error at higher orders, so other
formats are preferred when possible.</p>
</section>
<section id="zeros-and-poles-representation">
<h5>Zeros and poles representation<a class="headerlink" href="#zeros-and-poles-representation" title="Link to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">zpk</span></code> format is a 3-tuple <code class="docutils literal notranslate"><span class="pre">(z,</span> <span class="pre">p,</span> <span class="pre">k)</span></code>, where <em class="xref py py-obj">z</em> is an <em class="xref py py-obj">M</em>-length
array of the complex zeros of the transfer function
<span class="math notranslate nohighlight">\(z = [z_0, z_1, ..., z_{M-1}]\)</span>, <em class="xref py py-obj">p</em> is an <em class="xref py py-obj">N</em>-length array of the
complex poles of the transfer function <span class="math notranslate nohighlight">\(p = [p_0, p_1, ..., p_{N-1}]\)</span>,
and <em class="xref py py-obj">k</em> is a scalar gain.  These represent the digital transfer function:</p>
<div class="math notranslate nohighlight">
\[H(z) = k \cdot \frac
{(z - z_0) (z - z_1) \cdots (z - z_{(M-1)})}
{(z - p_0) (z - p_1) \cdots (z - p_{(N-1)})}
= k \frac
{\prod_{i=0}^{M-1} (z - z_i)}
{\prod_{i=0}^{N-1} (z - p_i)}\]</div>
<p>or the analog transfer function:</p>
<div class="math notranslate nohighlight">
\[H(s) = k \cdot \frac
{(s - z_0) (s - z_1) \cdots (s - z_{(M-1)})}
{(s - p_0) (s - p_1) \cdots (s - p_{(N-1)})}
= k \frac
{\prod_{i=0}^{M-1} (s - z_i)}
{\prod_{i=0}^{N-1} (s - p_i)}.\]</div>
<p>Although the sets of roots are stored as ordered NumPy arrays, their ordering
does not matter: <code class="docutils literal notranslate"><span class="pre">([-1,</span> <span class="pre">-2],</span> <span class="pre">[-3,</span> <span class="pre">-4],</span> <span class="pre">1)</span></code> is the same filter as
<code class="docutils literal notranslate"><span class="pre">([-2,</span> <span class="pre">-1],</span> <span class="pre">[-4,</span> <span class="pre">-3],</span> <span class="pre">1)</span></code>.</p>
</section>
<section id="state-space-system-representation">
<h5>State-space system representation<a class="headerlink" href="#state-space-system-representation" title="Link to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">ss</span></code> format is a 4-tuple of arrays <code class="docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">B,</span> <span class="pre">C,</span> <span class="pre">D)</span></code> representing the
state-space of an <em class="xref py py-obj">N</em>-order digital/discrete-time system of the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{x}[k+1] = A \mathbf{x}[k] + B \mathbf{u}[k]\\
\mathbf{y}[k] = C \mathbf{x}[k] + D \mathbf{u}[k]\end{split}\]</div>
<p>or a continuous/analog system of the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\mathbf{x}}(t) = A \mathbf{x}(t) + B \mathbf{u}(t)\\
\mathbf{y}(t) = C \mathbf{x}(t) + D \mathbf{u}(t),\end{split}\]</div>
<p>with <em class="xref py py-obj">P</em> inputs, <em class="xref py py-obj">Q</em> outputs and <em class="xref py py-obj">N</em> state variables, where:</p>
<ul class="simple">
<li><p><em class="xref py py-obj">x</em> is the state vector</p></li>
<li><p><em class="xref py py-obj">y</em> is the output vector of length <em class="xref py py-obj">Q</em></p></li>
<li><p><em class="xref py py-obj">u</em> is the input vector of length <em class="xref py py-obj">P</em></p></li>
<li><p><em class="xref py py-obj">A</em> is the state matrix, with shape <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">N)</span></code></p></li>
<li><p><em class="xref py py-obj">B</em> is the input matrix with shape <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">P)</span></code></p></li>
<li><p><em class="xref py py-obj">C</em> is the output matrix with shape <code class="docutils literal notranslate"><span class="pre">(Q,</span> <span class="pre">N)</span></code></p></li>
<li><p><em class="xref py py-obj">D</em> is the feedthrough or feedforward matrix with shape <code class="docutils literal notranslate"><span class="pre">(Q,</span> <span class="pre">P)</span></code>.  (In
cases where the system does not have a direct feedthrough, all values in
<em class="xref py py-obj">D</em> are zero.)</p></li>
</ul>
<p>State-space is the most general representation and the only one that allows
for multiple-input, multiple-output (MIMO) systems. There are multiple
state-space representations for a given transfer function. Specifically, the
“controllable canonical form” and “observable canonical form” have the same
coefficients as the <code class="docutils literal notranslate"><span class="pre">tf</span></code> representation, and, therefore, suffer from the same
numerical errors.</p>
</section>
<section id="second-order-sections-representation">
<h5>Second-order sections representation<a class="headerlink" href="#second-order-sections-representation" title="Link to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">sos</span></code> format is a single 2-D array of shape <code class="docutils literal notranslate"><span class="pre">(n_sections,</span> <span class="pre">6)</span></code>,
representing a sequence of second-order transfer functions which, when
cascaded in series, realize a higher-order filter with minimal numerical
error. Each row corresponds to a second-order <code class="docutils literal notranslate"><span class="pre">tf</span></code> representation, with
the first three columns providing the numerator coefficients and the last
three providing the denominator coefficients:</p>
<div class="math notranslate nohighlight">
\[[b_0, b_1, b_2, a_0, a_1, a_2]\]</div>
<p>The coefficients are typically normalized, such that <span class="math notranslate nohighlight">\(a_0\)</span> is always 1.
The section order is usually not important with floating-point computation;
the filter output will be the same, regardless of the order.</p>
</section>
</section>
<section id="filter-transformations">
<h4>Filter transformations<a class="headerlink" href="#filter-transformations" title="Link to this heading">#</a></h4>
<p>The IIR filter design functions first generate a prototype analog low-pass filter
with a normalized cutoff frequency of 1 rad/sec. This is then transformed into
other frequencies and band types using the following substitutions:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Transformation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/generated/scipy.signal.lp2lp.html#scipy.signal.lp2lp" title="scipy.signal.lp2lp"><code class="xref py py-func docutils literal notranslate"><span class="pre">lp2lp</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(s \rightarrow \frac{s}{\omega_0}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/generated/scipy.signal.lp2hp.html#scipy.signal.lp2hp" title="scipy.signal.lp2hp"><code class="xref py py-func docutils literal notranslate"><span class="pre">lp2hp</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(s \rightarrow \frac{\omega_0}{s}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/generated/scipy.signal.lp2bp.html#scipy.signal.lp2bp" title="scipy.signal.lp2bp"><code class="xref py py-func docutils literal notranslate"><span class="pre">lp2bp</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(s \rightarrow \frac{s^2 + {\omega_0}^2}{s \cdot \mathrm{BW}}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/generated/scipy.signal.lp2bs.html#scipy.signal.lp2bs" title="scipy.signal.lp2bs"><code class="xref py py-func docutils literal notranslate"><span class="pre">lp2bs</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(s \rightarrow \frac{s \cdot \mathrm{BW}}{s^2 + {\omega_0}^2}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Here, <span class="math notranslate nohighlight">\(\omega_0\)</span> is the new cutoff or center frequency, and
<span class="math notranslate nohighlight">\(\mathrm{BW}\)</span> is the bandwidth.  These preserve symmetry on a logarithmic
frequency axis.</p>
<p>To convert the transformed analog filter into a digital filter, the
<a class="reference internal" href="../reference/generated/scipy.signal.bilinear.html#scipy.signal.bilinear" title="scipy.signal.bilinear"><code class="xref py py-func docutils literal notranslate"><span class="pre">bilinear</span></code></a> transform is used, which makes the following substitution:</p>
<div class="math notranslate nohighlight">
\[s \rightarrow \frac{2}{T} \frac{z - 1}{z + 1},\]</div>
<p>where T is the sampling time (the inverse of the sampling frequency).</p>
</section>
</section>
<section id="other-filters">
<h3>Other filters<a class="headerlink" href="#other-filters" title="Link to this heading">#</a></h3>
<p>The signal processing package provides many more filters as well.</p>
<section id="median-filter">
<h4>Median Filter<a class="headerlink" href="#median-filter" title="Link to this heading">#</a></h4>
<p>A median filter is commonly applied when noise is markedly non-Gaussian or
when it is desired to preserve edges. The median filter works by sorting all
of the array pixel values in a rectangular region surrounding the point of
interest. The sample median of this list of neighborhood pixel values is used
as the value for the output array. The sample median is the middle-array value
in a sorted list of neighborhood values. If there are an even number of
elements in the neighborhood, then the average of the middle two values is
used as the median. A general purpose median filter that works on
N-D arrays is <a class="reference internal" href="../reference/generated/scipy.signal.medfilt.html#scipy.signal.medfilt" title="scipy.signal.medfilt"><code class="xref py py-func docutils literal notranslate"><span class="pre">medfilt</span></code></a>. A specialized version that works
only for 2-D arrays is available as <a class="reference internal" href="../reference/generated/scipy.signal.medfilt2d.html#scipy.signal.medfilt2d" title="scipy.signal.medfilt2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">medfilt2d</span></code></a>.</p>
</section>
<section id="order-filter">
<h4>Order Filter<a class="headerlink" href="#order-filter" title="Link to this heading">#</a></h4>
<p>A median filter is a specific example of a more general class of filters
called order filters. To compute the output at a particular pixel, all order
filters use the array values in a region surrounding that pixel. These array
values are sorted and then one of them is selected as the output value. For
the median filter, the sample median of the list of array values is used as
the output. A general-order filter allows the user to select which of the
sorted values will be used as the output. So, for example, one could choose to
pick the maximum in the list or the minimum. The order filter takes an
additional argument besides the input array and the region mask that specifies
which of the elements in the sorted list of neighbor array values should be
used as the output. The command to perform an order filter is
<a class="reference internal" href="../reference/generated/scipy.signal.order_filter.html#scipy.signal.order_filter" title="scipy.signal.order_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">order_filter</span></code></a>.</p>
</section>
<section id="wiener-filter">
<h4>Wiener filter<a class="headerlink" href="#wiener-filter" title="Link to this heading">#</a></h4>
<p>The Wiener filter is a simple deblurring filter for denoising images. This is
not the Wiener filter commonly described in image-reconstruction problems but,
instead, it is a simple, local-mean filter. Let <span class="math notranslate nohighlight">\(x\)</span> be the input signal,
then the output is</p>
<div class="math notranslate nohighlight">
\[\begin{split}y=\left\{ \begin{array}{cc} \frac{\sigma^{2}}{\sigma_{x}^{2}}m_{x}+\left(1-\frac{\sigma^{2}}{\sigma_{x}^{2}}\right)x &amp; \sigma_{x}^{2}\geq\sigma^{2},\\ m_{x} &amp; \sigma_{x}^{2}&lt;\sigma^{2},\end{array}\right.\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(m_{x}\)</span> is the local estimate of the mean and
<span class="math notranslate nohighlight">\(\sigma_{x}^{2}\)</span> is the local estimate of the variance. The window for
these estimates is an optional input parameter (default is <span class="math notranslate nohighlight">\(3\times3\)</span> ).
The parameter <span class="math notranslate nohighlight">\(\sigma^{2}\)</span> is a threshold noise parameter. If
<span class="math notranslate nohighlight">\(\sigma\)</span> is not given, then it is estimated as the average of the local
variances.</p>
</section>
<section id="hilbert-filter">
<h4>Hilbert filter<a class="headerlink" href="#hilbert-filter" title="Link to this heading">#</a></h4>
<p>The Hilbert transform constructs the complex-valued analytic signal
from a real signal. For example, if <span class="math notranslate nohighlight">\(x=\cos\omega n\)</span>, then
<span class="math notranslate nohighlight">\(y=\textrm{hilbert}\left(x\right)\)</span> would return (except near the
edges) <span class="math notranslate nohighlight">\(y=\exp\left(j\omega n\right).\)</span> In the frequency domain,
the hilbert transform performs</p>
<div class="math notranslate nohighlight">
\[Y=X\cdot H,\]</div>
<p>where <span class="math notranslate nohighlight">\(H\)</span> is <span class="math notranslate nohighlight">\(2\)</span> for positive frequencies, <span class="math notranslate nohighlight">\(0\)</span> for negative
frequencies, and <span class="math notranslate nohighlight">\(1\)</span> for zero-frequencies.</p>
</section>
</section>
<section id="analog-filter-design">
<h3>Analog Filter Design<a class="headerlink" href="#analog-filter-design" title="Link to this heading">#</a></h3>
<p>The functions <a class="reference internal" href="../reference/generated/scipy.signal.iirdesign.html#scipy.signal.iirdesign" title="scipy.signal.iirdesign"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirdesign</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="scipy.signal.iirfilter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iirfilter</span></code></a>, and the filter design
functions for specific filter types (e.g., <a class="reference internal" href="../reference/generated/scipy.signal.ellip.html#scipy.signal.ellip" title="scipy.signal.ellip"><code class="xref py py-func docutils literal notranslate"><span class="pre">ellip</span></code></a>) all have a flag
<em class="xref py py-obj">analog</em>, which allows the design of analog filters as well.</p>
<p>The example below designs an analog (IIR) filter, obtains via <a class="reference internal" href="../reference/generated/scipy.signal.tf2zpk.html#scipy.signal.tf2zpk" title="scipy.signal.tf2zpk"><code class="xref py py-func docutils literal notranslate"><span class="pre">tf2zpk</span></code></a>
the poles and zeros and plots them in the complex s-plane. The zeros at
<span class="math notranslate nohighlight">\(\omega \approx 150\)</span> and <span class="math notranslate nohighlight">\(\omega \approx 300\)</span> can be clearly seen
in the amplitude response.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">iirdesign</span><span class="p">(</span><span class="n">wp</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">gpass</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gstop</span><span class="o">=</span><span class="mf">40.</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Analog filter frequency response&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude Response [dB]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is an IIR filter response as an X-Y plot with amplitude response on the Y axis vs frequency on the X axis. The low-pass filter shown has a passband from 0 to 100 Hz with 0 dB response and a stop-band from about 175 Hz to 1 KHz about 40 dB down. There are two sharp discontinuities in the filter near 175 Hz and 300 Hz. The second plot is an X-Y showing the transfer function in the complex plane. The Y axis is real-valued an the X axis is complex-valued. The filter has four zeros near [300+0j, 175+0j, -175+0j, -300+0j] shown as blue X markers. The filter also has four poles near [50-30j, -50-30j, 100-8j, -100-8j] shown as red dots.&quot;" class="plot-directive" src="../_images/signal-8_00_00.png" />
</figure>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s1">&#39;xr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Zeros&#39;</span><span class="p">,</span> <span class="s1">&#39;Poles&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Pole / Zero Plot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="&quot;This code displays two plots. The first plot is an IIR filter response as an X-Y plot with amplitude response on the Y axis vs frequency on the X axis. The low-pass filter shown has a passband from 0 to 100 Hz with 0 dB response and a stop-band from about 175 Hz to 1 KHz about 40 dB down. There are two sharp discontinuities in the filter near 175 Hz and 300 Hz. The second plot is an X-Y showing the transfer function in the complex plane. The Y axis is real-valued an the X axis is complex-valued. The filter has four zeros near [300+0j, 175+0j, -175+0j, -300+0j] shown as blue X markers. The filter also has four poles near [50-30j, -50-30j, 100-8j, -100-8j] shown as red dots.&quot;" class="plot-directive" src="../_images/signal-8_01_00.png" />
</figure>
<div class="math notranslate nohighlight">
\[% LaTeX Macros to make the LaTeX formulas more readable:
\newcommand{\IC}{{\mathbb{C}}}  % set of complex numbers
\newcommand{\IN}{{\mathbb{N}}}  % set of natural numbers
\newcommand{\IR}{{\mathbb{R}}}  % set of real numbers
\newcommand{\IZ}{{\mathbb{Z}}}  % set of integers
\newcommand{\jj}{{\mathbb{j}}}  % imaginary unit
\newcommand{\e}{\operatorname{e}}  % Euler's number
\newcommand{\dd}{\operatorname{d}} % infinitesimal operator
\newcommand{\abs}[1]{\left|#1\right|} % absolute value
\newcommand{\conj}[1]{\overline{#1}} % complex conjugate
\newcommand{\conjT}[1]{\overline{#1^T}} % transposed complex conjugate
\newcommand{\inv}[1]{\left(#1\right)^{\!-1}} % inverse
% Since the physics package is not loaded, we define the macros ourselves:
\newcommand{\vb}[1]{\mathbf{#1}} % vectors and matrices are bold
% new macros:
\newcommand{\rect}{\operatorname{rect}}  % rect or boxcar function
\newcommand{\sinc}{\operatorname{sinc}}  % sinc(t) := sin(pi*t) / (pi*t)\]</div>
</section>
</section>
<section id="spectral-analysis">
<span id="tutorial-spectralanalysis"></span><h2>Spectral Analysis<a class="headerlink" href="#spectral-analysis" title="Link to this heading">#</a></h2>
<p>Spectral analysis refers to investigating the Fourier transform <a class="footnote-reference brackets" href="#wiki-ft" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> of a
signal. Depending on the context, various names, like spectrum, spectral density or
periodogram exist for the various spectral representations of the Fourier transform.
<a class="footnote-reference brackets" href="#wiki-spectd" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> This section illustrates the most common representations by the example
of a continuous-time sine wave signal of fixed duration. Then the use of the discrete
Fourier transform <a class="footnote-reference brackets" href="#wiki-dft" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> on a sampled version of that sine wave is discussed.</p>
<p>Separate subsections are devoted to the spectrum’s phase, estimating the power spectral
density without (<a class="reference internal" href="../reference/generated/scipy.signal.periodogram.html#scipy.signal.periodogram" title="scipy.signal.periodogram"><code class="xref py py-func docutils literal notranslate"><span class="pre">periodogram</span></code></a>) and with averaging
(<a class="reference internal" href="../reference/generated/scipy.signal.welch.html#scipy.signal.welch" title="scipy.signal.welch"><code class="xref py py-func docutils literal notranslate"><span class="pre">welch</span></code></a>) as well for non-equally spaced signals
(<a class="reference internal" href="../reference/generated/scipy.signal.lombscargle.html#scipy.signal.lombscargle" title="scipy.signal.lombscargle"><code class="xref py py-func docutils literal notranslate"><span class="pre">lombscargle</span></code></a>).</p>
<p>Note that the concept of Fourier series is closely related but differs in a crucial
point: Fourier series have a spectrum made up of discrete-frequency harmonics, while in
this section the spectra are continuous in frequency.</p>
<section id="continuous-time-sine-signal">
<h3>Continuous-time Sine Signal<a class="headerlink" href="#continuous-time-sine-signal" title="Link to this heading">#</a></h3>
<p>Consider a sine signal with amplitude <span class="math notranslate nohighlight">\(a\)</span>, frequency <span class="math notranslate nohighlight">\(f_x\)</span> and duration
<span class="math notranslate nohighlight">\(\tau\)</span>, i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-sine">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-specta-sine" title="Link to this equation">#</a></span>\[x(t) = a \sin(2 \pi f_x t)\, \rect(\frac{t}{\tau}-\frac{1}{2})
     = \left(\frac{a}{2\jj}
          \e^{\jj 2 \pi f_x t} - \frac{a}{2\jj} \e^{-\jj 2 \pi f_x t}
       \right) \rect(\frac{t}{\tau}-\frac{1}{2})\ .\]</div>
<p>Since the <span class="math notranslate nohighlight">\(\rect(t)\)</span> function is one for <span class="math notranslate nohighlight">\(|t|&lt;1/2\)</span> and zero for
<span class="math notranslate nohighlight">\(|t|&gt;1/2\)</span>, it limits <span class="math notranslate nohighlight">\(x(t)\)</span> to the interval <span class="math notranslate nohighlight">\([0, \tau]\)</span>. Expressing
the sine by complex exponentials shows its two periodic components with frequencies
<span class="math notranslate nohighlight">\(\pm f_x\)</span>. We assume <span class="math notranslate nohighlight">\(x(t)\)</span> to be a voltage signal, so it has the unit
<span class="math notranslate nohighlight">\(\text{V}\)</span>.</p>
<p>In signal processing the integral of the absolute square <span class="math notranslate nohighlight">\(|x(t)|^2\)</span> is utilized
to define energy and power of a signal, i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-contenergy">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-specta-contenergy" title="Link to this equation">#</a></span>\[E_x :=  \int_0^\tau |x(t)|^2 \dd t\ = \frac{1}{2}|a|^2\tau\ , \qquad
P_x := \frac{1}{\tau}E_x = \frac{1}{2}|a|^2\ .\]</div>
<p>The power <span class="math notranslate nohighlight">\(P_x\)</span> can be interpreted as the energy <span class="math notranslate nohighlight">\(E_x\)</span> per unit time
interval. Unit-wise, integrating over <span class="math notranslate nohighlight">\(t\)</span> results in multiplication with seconds.
Hence, <span class="math notranslate nohighlight">\(E_x\)</span> has unit <span class="math notranslate nohighlight">\(\text{V}^2\text{s}\)</span> and <span class="math notranslate nohighlight">\(P_x\)</span> has the unit
<span class="math notranslate nohighlight">\(\text{V}^2\)</span>.</p>
<p>Applying the Fourier transform to <span class="math notranslate nohighlight">\(x(t)\)</span>, i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-ft-sine">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-specta-ft-sine" title="Link to this equation">#</a></span>\[X(f) = \int_{\IR} x(t)\, \e^{-2\jj\pi f t}\, \dd t
     = \frac{a \tau}{2\jj} \Big(
        \sinc\!\big(\tau (f-f_x)\big) - \sinc\!\big(\tau (f+f_x)\big)
       \Big)\e^{-\jj\pi\tau f}\ ,\]</div>
<p>results in two <span class="math notranslate nohighlight">\(\sinc(f) := \sin(\pi f) /(\pi f)\)</span> functions centered at
<span class="math notranslate nohighlight">\(\pm f_x\)</span>. The magnitude (absolute value) <span class="math notranslate nohighlight">\(|X(f)|\)</span> has two maxima located
at <span class="math notranslate nohighlight">\(\pm f_x\)</span> with value <span class="math notranslate nohighlight">\(|a|\tau/2\)</span>. It can be seen in the plot below that
<span class="math notranslate nohighlight">\(X(f)\)</span> is not concentrated around the main lobes at <span class="math notranslate nohighlight">\(\pm f_x\)</span>, but contains
side lobes with heights decreasing proportional to <span class="math notranslate nohighlight">\(1/(\tau f)\)</span>. This so-called
“spectral leakage” <a class="footnote-reference brackets" href="#wiki-spectralleakage" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> is caused by confining the sine to a finite
interval. Note that the shorter the signal duration <span class="math notranslate nohighlight">\(\tau\)</span> is, the higher the
leakage. To be independent of the signal duration, the so-called “amplitude spectrum”
<span class="math notranslate nohighlight">\(X(f)/\tau\)</span> can be used instead of the spectrum <span class="math notranslate nohighlight">\(X(f)\)</span>. Its value at
<span class="math notranslate nohighlight">\(f\)</span> corresponds to the amplitude of the complex exponential <span class="math notranslate nohighlight">\(\exp(\jj2\pi f
t)\)</span>.</p>
<p>Due to Parseval’s theorem, the energy can be calculated from its Fourier transform
<span class="math notranslate nohighlight">\(X(f)\)</span> by</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-ft-energy">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-specta-ft-energy" title="Link to this equation">#</a></span>\[    E_X :=  \int_\IR \abs{X(f)}^2 \dd f = E_x\]</div>
<p>as well. E.g., it can be shown by direct calculation that the energy of <span class="math notranslate nohighlight">\(X(f)\)</span> of
Eq. <a class="reference internal" href="#equation-eq-specta-ft-energy">(4)</a> is <span class="math notranslate nohighlight">\(|a|^2\tau/2\)</span>. Hence, the signal’s power
in a frequency band <span class="math notranslate nohighlight">\([f_a, f_b]\)</span> can be determined with</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-ft-poweri">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-specta-ft-poweri" title="Link to this equation">#</a></span>\[P_X^{a,b} =  \frac{1}{\tau} \int_{f_a}^{f_b} \abs{X(f)}^2 \dd f\ .\]</div>
<p>Thus the function <span class="math notranslate nohighlight">\(|X(f)|^2\)</span> can be defined as the so-called “energy spectral
density and <span class="math notranslate nohighlight">\(S_{xx}(f) := |X(f)|^2 / \tau\)</span> as “power spectral density” (PSD) of
<span class="math notranslate nohighlight">\(x(t)\)</span>. Instead of the PSD, the so-called “amplitude spectral density”
<span class="math notranslate nohighlight">\(X(f) / \sqrt{\tau}\)</span> is also used, which still contains the phase information.
Its absolute square is the PSD and thus it is closely related to the concept of the
root-mean-square (RMS) value <span class="math notranslate nohighlight">\(\sqrt{P_x}\)</span> of a signal.</p>
<p>In summary, this subsection presented five ways to represent a spectrum:</p>
<div class="pst-scrollable-table-container"><table class="table" id="id17">
<caption><span class="caption-text">Comparison of Spectral Representations of sine signal <span class="math notranslate nohighlight">\(x(t)\)</span>
             of Eq. <a class="reference internal" href="#equation-eq-specta-sine">(1)</a> with unit <span class="math notranslate nohighlight">\(\text{V}\)</span>:</span><a class="headerlink" href="#id17" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Spectrum</p></th>
<th class="head"><p>Amplitude Spectrum</p></th>
<th class="head"><p>Energy Spectral Density</p></th>
<th class="head"><p>Power Spectral Density (PSD)</p></th>
<th class="head"><p>Amplitude Spectral Density</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Definition:</p></td>
<td><p><span class="math notranslate nohighlight">\(X(f)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(X(f) / \tau\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(|X(f)|^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(|X(f)|^2 / \tau\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(X(f) / \sqrt{\tau}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Magnitude at <span class="math notranslate nohighlight">\(\pm f_x\)</span>:</p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{2}|a|\tau\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{2}|a|\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{4}|a|^2\tau^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{4}|a|^2\tau\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{2}|a|\sqrt{\tau}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Unit:</p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V} / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}^2\text{s} / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}^2 / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V} / \sqrt{\text{Hz}}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that the units presented in the table above are not unambiguous, e.g.,
<span class="math notranslate nohighlight">\(\text{V}^2\text{s} / \text{Hz} = \text{V}^2\text{s}^2 = \text{V}^2/
\text{Hz}^2\)</span>. When using the absolute value of <span class="math notranslate nohighlight">\(|X(f) / \tau|\)</span> of the amplitude
spectrum, it is called a magnitude spectrum. Furthermore, note that the naming scheme
of the representations is not consistent and varies in literature.</p>
<p>For real-valued signals the so-called “onesided” spectral representation is often utilized.
It only uses the non-negative frequencies (due to <span class="math notranslate nohighlight">\(X(-f)= \conj{X}(f)\)</span> if
<span class="math notranslate nohighlight">\(x(t)\in\IR\)</span>). Sometimes the values of the negative frequencies are added to their
positive counterparts. Then the amplitude spectrum allows to read off the full (not
half) amplitude sine  of <span class="math notranslate nohighlight">\(x(t)\)</span> at <span class="math notranslate nohighlight">\(f_x\)</span> and the area of an interval in
the PSD represents its full (not half) power. Note that for amplitude spectral
densities the positive values are not doubled but multiplied by <span class="math notranslate nohighlight">\(\sqrt{2}\)</span>, since
it is the square root of the PSD. Furthermore, there is no canonical way for naming a
doubled spectrum.</p>
<p>The following plot shows three different spectral representations of four sine signals
<span class="math notranslate nohighlight">\(x(t)\)</span> of Eq. <a class="reference internal" href="#equation-eq-specta-sine">(1)</a> with different amplitudes <span class="math notranslate nohighlight">\(a\)</span>
and durations <span class="math notranslate nohighlight">\(\tau\)</span>. For less clutter, the spectra are centered at <span class="math notranslate nohighlight">\(f_x\)</span>
and being are plotted next to each other:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># amplitudes</span>
<span class="n">taus</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># durations</span>

<span class="n">fg0</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">))</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Spectrum $|X(f)|$&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;V/Hz&quot;</span><span class="p">)</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Magnitude Spectrum $|X(f)/\tau|$ &quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Amplitude Spectral Density $|X(f)/\sqrt{\tau}|$&quot;</span><span class="p">,</span>
           <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\operatorname</span><span class="si">{V}</span><span class="s2"> / \sqrt{\operatorname</span><span class="si">{Hz}</span><span class="s2">}$&quot;</span><span class="p">,</span>
           <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Frequency $f$ in Hertz&quot;</span><span class="p">,)</span>

<span class="n">x_labels</span><span class="p">,</span> <span class="n">x_ticks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c_</span><span class="p">,</span> <span class="p">(</span><span class="n">a_</span><span class="p">,</span> <span class="n">tau_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">taus</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">aZ_</span><span class="p">,</span> <span class="n">f_</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_</span> <span class="o">*</span> <span class="n">tau_</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">tau_</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">f</span> <span class="o">+</span> <span class="n">c_</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_</span><span class="p">,</span> <span class="n">aZ_</span><span class="p">)</span>
    <span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_</span><span class="p">,</span> <span class="n">aZ_</span> <span class="o">/</span> <span class="n">tau_</span><span class="p">)</span>
    <span class="n">axx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_</span><span class="p">,</span> <span class="n">aZ_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tau_</span><span class="p">))</span>
    <span class="n">x_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;$a=</span><span class="si">{</span><span class="n">a_</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">$, $\tau=</span><span class="si">{</span><span class="n">tau_</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">x_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">axx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_ContinuousSpectralRepresentations.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_ContinuousSpectralRepresentations.png" />
</figure>
<p>Note that depending on the representation, the height of the peaks vary. Only the
interpretation of the magnitude spectrum is straightforward: The peak at <span class="math notranslate nohighlight">\(f_x\)</span> in
the second plot represents half the magnitude <span class="math notranslate nohighlight">\(|a|\)</span> of the sine signal. For all other
representations the duration <span class="math notranslate nohighlight">\(\tau\)</span> needs to be taken into account to extract
information about the signal’s amplitude.</p>
</section>
<section id="sampled-sine-signal">
<h3>Sampled Sine Signal<a class="headerlink" href="#sampled-sine-signal" title="Link to this heading">#</a></h3>
<p>In practice sampled signals are widely used. I.e., the signal is represented by <span class="math notranslate nohighlight">\(n\)</span>
samples <span class="math notranslate nohighlight">\(x_k := x(kT)\)</span>, <span class="math notranslate nohighlight">\(k=0, \ldots, n-1\)</span>, where <span class="math notranslate nohighlight">\(T\)</span> is the sampling
interval, <span class="math notranslate nohighlight">\(\tau:=nT\)</span> the signal’s duration and <span class="math notranslate nohighlight">\(f_S := 1/T\)</span> the sampling
frequency. Note that the continuous signal needs to be band-limited to <span class="math notranslate nohighlight">\([-f_S/2,
f_S/2]\)</span> to avoid aliasing, with <span class="math notranslate nohighlight">\(f_S/2\)</span> being called Nyquist frequency.
<a class="footnote-reference brackets" href="#wiki-nyqistshannon" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>  Replacing the integral by a sum to calculate the signal’s
energy and power, i.e.,</p>
<div class="math notranslate nohighlight">
\[E_x = T\sum_{k=0}^{n-1} \abs{x_k}^2 = \frac{1}{2}|a|^2\tau\ , \qquad
P_x = \frac{1}{\tau}E_x =  \frac{1}{2}|a|^2\ ,\]</div>
<p>delivers the identical result as in the continuous time case of Eq.
<a class="reference internal" href="#equation-eq-specta-contenergy">(2)</a>. The discrete Fourier transform (DFT) and its
inverse (as implemented using efficient FFT calculations in the <a class="reference internal" href="../reference/fft.html#module-scipy.fft" title="scipy.fft"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.fft</span></code></a> module)
is given by</p>
<div class="math notranslate nohighlight">
\[X_l := \sum_{k=0}^{n-1} x_k \e^{-2\jj\pi k l / n}\ ,\qquad
x_k = \frac{1}{n} \sum_{l=0}^{n-1} X_l \e^{2\jj\pi k l / n}\ .\]</div>
<p>The DFT and can be interpreted as an unscaled sampled version of the continuous Fourier
transform of Eq. <a class="reference internal" href="#equation-eq-specta-ft-sine">(3)</a>, i.e.,</p>
<div class="math notranslate nohighlight">
\[X(l\Delta f) = T X_l\ , \quad \Delta f := 1/\tau = 1/(nT)\ .\]</div>
<p>The following plot shows the magnitude spectrum of two sine signals with unit amplitude
and frequencies of 20 Hz and 20.5 Hz. The signal is made up of <span class="math notranslate nohighlight">\(n=100\)</span> samples
with a sampling interval of <span class="math notranslate nohighlight">\(T=10\)</span> ms resulting in a duration of <span class="math notranslate nohighlight">\(\tau=1\)</span> s
and a sampling frequency of <span class="math notranslate nohighlight">\(f_S=100\)</span> Hz.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">rfftfreq</span>

<span class="n">n</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.01</span>  <span class="c1"># number of samples and sampling interval</span>
<span class="n">fcc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">20.5</span><span class="p">)</span>  <span class="c1"># frequencies of sines</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fx_</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">fx_</span> <span class="ow">in</span> <span class="n">fcc</span><span class="p">)</span>  <span class="c1"># sine signals</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># frequency bins range from 0 Hz to Nyquist freq.</span>
<span class="n">XX</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfft</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">)</span>  <span class="c1"># one-sided magnitude spectrum</span>

<span class="n">fg1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Magnitude Spectrum (no window) of $x(t) = \sin(2\pi f_x t)$ &quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Frequency $f$ in Hertz (bin width $\Delta f = </span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">\,$Hz)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Magnitude $|X(f)|/\tau$&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">X_</span><span class="p">,</span> <span class="n">fc_</span><span class="p">,</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">XX</span><span class="p">,</span> <span class="n">fcc</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;x-&#39;</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">X_</span><span class="p">),</span> <span class="n">m_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;$f_x=</span><span class="si">{</span><span class="n">fc_</span><span class="si">}</span><span class="s2">\,$Hz&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_TwoSinesNoWindow.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_TwoSinesNoWindow.png" />
</figure>
<p>The interpretation of the 20 Hz signal seems straightforward: All values are zero
except at 20 Hz. There it is 0.5, which corresponds to half the amplitude of the input
signal in accordance with Eq. <a class="reference internal" href="#equation-eq-specta-sine">(1)</a>. The peak of the 20.5 Hz
signal on the other hand is dispersed along the frequency axis. Eq.
<a class="reference internal" href="#equation-eq-specta-ft-sine">(3)</a> shows that this difference is caused by the reason
that 20 Hz is a multiple of the bin width of 1 Hz whereas 20.5 Hz is not. The following
plot illustrates this by overlaying continuous spectrum over the sampled one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">rfftfreq</span>

<span class="n">n</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.01</span>  <span class="c1"># number of samples and sampling interval</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">T</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span>
<span class="n">fcc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">20.5</span><span class="p">)</span>  <span class="c1"># frequencies of sines</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fc_</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">fc_</span> <span class="ow">in</span> <span class="n">fcc</span><span class="p">)</span>  <span class="c1"># sine signals</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># frequency bins range from 0 Hz to Nyquist freq.</span>
<span class="n">XX</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfft</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">)</span>  <span class="c1"># one-sided FFT normalized to magnitude</span>

<span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span>
<span class="n">f_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i1</span><span class="p">],</span> <span class="mi">501</span><span class="p">)</span>

<span class="n">fg1</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
<span class="k">for</span> <span class="n">c_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_</span><span class="p">,</span> <span class="n">X_</span><span class="p">,</span> <span class="n">fx_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axx</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">fcc</span><span class="p">)):</span>
    <span class="n">Xc_</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_cont</span> <span class="o">-</span> <span class="n">fx_</span><span class="p">))</span> <span class="o">+</span>
           <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_cont</span> <span class="o">+</span> <span class="n">fx_</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_cont</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Xc_</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;-C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;$f_x=</span><span class="si">{</span><span class="n">fx_</span><span class="si">}</span><span class="s2">\,$Hz&quot;</span><span class="p">)</span>
    <span class="n">m_line</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">markerfmt</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;dC</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">linefmt</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Frequency $f$ in Hertz&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i1</span><span class="p">]),</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">))</span>

<span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Magnitude $|X(f)/\tau|$&#39;</span><span class="p">)</span>
<span class="n">fg1</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Continuous and Sampled Magnitude Spectrum &quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">)</span>
<span class="n">fg1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_SampledContinuousSpectrum.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_SampledContinuousSpectrum.png" />
</figure>
<p>That a slight variation in frequency produces significantly different looking magnitude
spectra is obviously undesirable behavior for many practical applications. The
following two common techniques can be utilized to improve a spectrum:</p>
<p>The so-called “zero-padding” decreases <span class="math notranslate nohighlight">\(\Delta f\)</span> by appending zeros to the end
of the signal. To oversample the frequency <em class="xref py py-obj">q</em> times, pass the parameter <code class="docutils literal notranslate"><span class="pre">n=q*n_x</span></code> to
the <a class="reference internal" href="../reference/generated/scipy.fft.fft.html#scipy.fft.fft" title="scipy.fft.fft"><code class="xref py py-func docutils literal notranslate"><span class="pre">fft</span></code></a> / <a class="reference internal" href="../reference/generated/scipy.fft.rfft.html#scipy.fft.rfft" title="scipy.fft.rfft"><code class="xref py py-func docutils literal notranslate"><span class="pre">rfft</span></code></a> function with <code class="docutils literal notranslate"><span class="pre">n_x</span></code> being the
length of the input signal.</p>
<p>The second technique is called windowing, i.e., multiplying the input signal with a
suited function such that typically the secondary lobes are suppressed at the cost of
widening the main lobe. The windowed DFT can be expressed as</p>
<div class="math notranslate nohighlight" id="equation-eq-specta-wdft">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-specta-wdft" title="Link to this equation">#</a></span>\[X^w_l := \sum_{k=0}^{n-1} x_k w_k\e^{-2\jj\pi k l / n}\ ,\]</div>
<p>where <span class="math notranslate nohighlight">\(w_k\)</span>, <span class="math notranslate nohighlight">\(k=0,\ldots,n-1\)</span> is the sampled window function. To calculate
the sampled versions of the spectral representations given in the previous subsection,
the following normalization constants</p>
<div class="math notranslate nohighlight">
\[c^\text{amp}:= \abs{\sum_{k=0}^{n-1} w_k}\ ,\qquad
c^\text{den} := \sqrt{\sum_{k=0}^{n-1} \abs{w_k}^2}\]</div>
<p>need to be utilized. The first one ensures that a peak in the spectrum is consistent
with the signal’s amplitude at that frequency. E.g., the magnitude spectrum can be
expressed by <span class="math notranslate nohighlight">\(|X^w_l / c^\text{amp}|\)</span>. The second constant guarantees that the
power of a frequency interval as defined in Eq. <a class="reference internal" href="#equation-eq-specta-ft-poweri">(5)</a> is
consistent. The absolute values are needed since complex-valued windows are not
forbidden.</p>
<p>The following plot shows the result of applying a <a class="reference internal" href="../reference/generated/scipy.signal.windows.hann.html#scipy.signal.windows.hann" title="scipy.signal.windows.hann"><code class="xref py py-func docutils literal notranslate"><span class="pre">hann</span></code></a>
window and three times over-sampling to <span class="math notranslate nohighlight">\(x(t)\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">rfftfreq</span>
<span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">hann</span>

<span class="n">n</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.01</span>  <span class="c1"># number of samples and sampling interval</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">T</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># over-sampling factor</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span>
<span class="n">fcc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">20.5</span><span class="p">)</span>  <span class="c1"># frequencies of sines</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fc_</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">fc_</span> <span class="ow">in</span> <span class="n">fcc</span><span class="p">]</span>  <span class="c1"># sine signals</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">hann</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">c_w</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>  <span class="c1"># normalize constant for window</span>

<span class="n">f_X</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># frequency bins range from 0 Hz to Nyquist freq.</span>
<span class="n">XX</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfft</span><span class="p">(</span><span class="n">x_</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">c_w</span> <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">)</span>  <span class="c1"># one-sided amplitude spectrum</span>
<span class="c1"># Oversampled spectrum:</span>
<span class="n">f_Y</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># frequency bins range from 0 Hz to Nyquist freq.</span>
<span class="n">YY</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfft</span><span class="p">(</span><span class="n">x_</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">q</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">c_w</span> <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">)</span>  <span class="c1"># one-sided magnitude spectrum</span>

<span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span>
<span class="n">j0</span><span class="p">,</span> <span class="n">j1</span> <span class="o">=</span> <span class="n">i0</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">i1</span><span class="o">*</span><span class="n">q</span>

<span class="n">fg1</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
<span class="k">for</span> <span class="n">c_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_</span><span class="p">,</span> <span class="n">X_</span><span class="p">,</span> <span class="n">Y_</span><span class="p">,</span> <span class="n">fx_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axx</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">,</span> <span class="n">fcc</span><span class="p">)):</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_Y</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Y_</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="sa">f</span><span class="s1">&#39;.-C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;$f_x=</span><span class="si">{</span><span class="n">fx_</span><span class="si">}</span><span class="s2">\,$Hz&quot;</span><span class="p">)</span>
    <span class="n">m_ln</span><span class="p">,</span> <span class="n">s_ln</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax_</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">f_X</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                              <span class="n">markerfmt</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;dC</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_ln</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_ln</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Frequency $f$ in Hertz&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">f_X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">f_X</span><span class="p">[</span><span class="mi">25</span><span class="p">]),</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">))</span>

<span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Magnitude $|X(f)/\tau|$&#39;</span><span class="p">)</span>
<span class="n">fg1</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Magnitude Spectrum (Hann window, $</span><span class="si">%d</span><span class="s2">\times$oversampled)&quot;</span> <span class="o">%</span> <span class="n">q</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_MagnitudeSpectrum_Hann_3x.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_MagnitudeSpectrum_Hann_3x.png" />
</figure>
<p>Now both lobes look almost identical and the side lobes are well suppressed. The
maximum of the 20.5 Hz spectrum is also very close to the expected height of one half.</p>
<p>Spectral energy and spectral power can be calculated analogously to Eq.
<a class="reference internal" href="#equation-eq-specta-ft-energy">(4)</a>, yielding in identical results, i.e.,</p>
<div class="math notranslate nohighlight">
\[E^w_X = T\sum_{k=0}^{n-1} \abs{\frac{X^w_k}{c^\text{den}}}^2
      = E_x\ ,\qquad
P^w_X = \frac{1}{\tau} E^w_X
      = \frac{1}{n} \sum_{k=0}^{n-1} \abs{\frac{X^w_k}{c^\text{den}}}^2
      = P_x\ .\]</div>
<p>This formulation is not to be confused with the special case of a rectangular window
(or no window), i.e., <span class="math notranslate nohighlight">\(w_k = 1\)</span>, <span class="math notranslate nohighlight">\(X^w_l=X_l\)</span>,
<span class="math notranslate nohighlight">\(c^\text{den}=\sqrt{n}\)</span>, which results in</p>
<div class="math notranslate nohighlight">
\[E_X = \frac{T}{n}\sum_{k=0}^{n-1} \abs{X_k}^2\ ,\qquad
P_X  = \frac{1}{n^2} \sum_{k=0}^{n-1} \abs{X_k}^2\ .\]</div>
<p>The windowed frequency-discrete power spectral density</p>
<div class="math notranslate nohighlight">
\[S^w_{xx} := \frac{1}{f_S}\abs{\frac{X^w_l}{c^\text{den}}}^2
          = T \abs{\frac{X^w_l}{c^\text{den}}}^2\]</div>
<p>is defined over the frequency range <span class="math notranslate nohighlight">\([0, f_S)\)</span> and can be interpreted as power
per frequency interval <span class="math notranslate nohighlight">\(\Delta f\)</span>. Integrating  over a frequency band
<span class="math notranslate nohighlight">\([l_a\Delta f, l_b\Delta f)\)</span>, like in Eq. <a class="reference internal" href="#equation-eq-specta-ft-poweri">(5)</a>,
becomes the sum</p>
<div class="math notranslate nohighlight">
\[P_X^{a,b} = \Delta f\sum_{k=l_a}^{l_b-1} S^w_{xx}
          = \frac{1}{nT}\sum_{k=l_a}^{l_b-1} S^w_{xx}\ .\]</div>
<p>The windowed frequency-discrete energy spectral density <span class="math notranslate nohighlight">\(\tau S^w_{xx}\)</span> can be
defined analogously.</p>
<p>The discussion above shows that sampled versions of the spectral representations as in
the continuous-time case can be defined. The following tables summarizes these:</p>
<div class="pst-scrollable-table-container"><table class="table" id="id18">
<caption><span class="caption-text">Comparison of Spectral Representations of a windowed DFT
             <span class="math notranslate nohighlight">\(X^w_l\)</span> of Eq. <a class="reference internal" href="#equation-eq-specta-wdft">(6)</a> for a
             sampled signal with unit <span class="math notranslate nohighlight">\(\text{V}\)</span>:</span><a class="headerlink" href="#id18" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Spectrum</p></th>
<th class="head"><p>Amplitude Spectrum</p></th>
<th class="head"><p>Energy Spectral Density</p></th>
<th class="head"><p>Power Spectral Density (PSD)</p></th>
<th class="head"><p>Amplitude Spectral Density</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Definition:</p></td>
<td><p><span class="math notranslate nohighlight">\(\tau X^w_l / c^\text{amp}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(X^w_l / c^\text{amp}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\tau T |X^w_l / c^\text{den}|^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(T |X^w_l / c^\text{den}|^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\sqrt{T} X^w_l / c^\text{den}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Unit:</p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V} / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}^2\text{s} / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V}^2 / \text{Hz}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\text{V} / \sqrt{\text{Hz}}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that for the densities, the magnitude values at <span class="math notranslate nohighlight">\(\pm f_x\)</span> differ to the
continuous time case due the change from integration to summation for determining
spectral energy/power.</p>
<p>Though the hann window is the most common window function used in spectral analysis,
other windows exist. The following plot shows the magnitude spectrum of various window
functions of the <a class="reference internal" href="../reference/signal.windows.html#module-scipy.signal.windows" title="scipy.signal.windows"><code class="xref py py-mod docutils literal notranslate"><span class="pre">windows</span></code></a> submodule. It may be interpreted as the
lobe shape of a single frequency input signal. Note that only the right half is shown
and the <span class="math notranslate nohighlight">\(y\)</span>-axis is in decibel, i.e., it is logarithmically scaled.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">rfftfreq</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">get_window</span>

<span class="n">n</span><span class="p">,</span> <span class="n">n_zp</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">16384</span>  <span class="c1"># number of samples without and with zero-padding</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n_zp</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>

<span class="n">ww</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boxcar&#39;</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;tukey&#39;</span><span class="p">,</span> <span class="s1">&#39;blackman&#39;</span><span class="p">,</span> <span class="s1">&#39;flattop&#39;</span><span class="p">]</span>
<span class="n">fg0</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ww</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">))</span>
<span class="k">for</span> <span class="n">c_</span><span class="p">,</span> <span class="p">(</span><span class="n">w_name_</span><span class="p">,</span> <span class="n">ax_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">axx</span><span class="p">)):</span>
    <span class="n">w_</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">w_name_</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">W_</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">w_</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w_</span><span class="p">)),</span> <span class="n">n</span><span class="o">=</span><span class="n">n_zp</span><span class="p">)</span>
    <span class="n">W_dB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">W_</span><span class="p">),</span> <span class="mf">1e-250</span><span class="p">))</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W_dB</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">w_name_</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_name_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C</span><span class="si">{</span><span class="n">c_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">])</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

<span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Spectral Leakage of various Windows&quot;</span><span class="p">)</span>
<span class="n">fg0</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Normalized Magnitude $20\,\log_</span><span class="si">{10}</span><span class="s2">|W(f)/c^\operatorname</span><span class="si">{amp}</span><span class="s2">|$ in dB&quot;</span><span class="p">,</span>
              <span class="n">x</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="n">axx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized frequency $f/\Delta f$ in bins&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">fg0</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_SpectralLeakageWindows.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_SpectralLeakageWindows.png" />
</figure>
<p>This plot shows that the choice of window function is typically a trade-off between
width of the main lobes and the height of the side lobes. Note that the
<a class="reference internal" href="../reference/generated/scipy.signal.windows.boxcar.html#scipy.signal.windows.boxcar" title="scipy.signal.windows.boxcar"><code class="xref py py-func docutils literal notranslate"><span class="pre">boxcar</span></code></a> window corresponds to a <span class="math notranslate nohighlight">\(\rect\)</span> function,
i.e., to no windowing. Furthermore, many of the depicted windows are more frequently
used in filter design than in spectral analysis.</p>
</section>
<section id="phase-of-spectrum">
<h3>Phase of Spectrum<a class="headerlink" href="#phase-of-spectrum" title="Link to this heading">#</a></h3>
<p>The phase (i.e., <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.angle.html#numpy.angle" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">angle</span></code></a>) of the Fourier transform is typically utilized
for investigating the time delay of the spectral components of a signal passing through
a system like a filter. In the following example the standard test signal, an impulse
with unit power, is passed through a simple filter, which delays the input by three
samples. The input consists of <span class="math notranslate nohighlight">\(n=50\)</span> samples with sampling interval <span class="math notranslate nohighlight">\(T =
1\)</span> s. The plot shows magnitude and phase over frequency of the input and the output
signal:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">rfftfreq</span>

<span class="c1"># Create input signal:</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>

<span class="c1"># Apply FIR filter which delays signal by 3 samples:</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfft</span><span class="p">(</span><span class="n">z_</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="k">for</span> <span class="n">z_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># sampling interval T = 1 s</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">Z_</span><span class="p">,</span> <span class="n">n_</span><span class="p">,</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Input $X(f)$&quot;</span><span class="p">,</span> <span class="s2">&quot;Output $Y(f)$&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="s1">&#39;x-&#39;</span><span class="p">)):</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Z_</span><span class="p">),</span> <span class="n">m_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n_</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Z_</span><span class="p">)),</span> <span class="n">m_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n_</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Frequency Response of 3 Sample Delay Filter (no window)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Frequency $f$ in Hertz ($\Delta f = </span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="si">}</span><span class="s2">\,$Hz)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Phase in rad&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
               <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;-π/2&#39;</span><span class="p">,</span> <span class="s1">&#39;-π&#39;</span><span class="p">,</span> <span class="s1">&#39;-3/2π&#39;</span><span class="p">,</span> <span class="s1">&#39;-2π&#39;</span><span class="p">,</span> <span class="s1">&#39;-4/3π&#39;</span><span class="p">,</span> <span class="s1">&#39;-3π&#39;</span><span class="p">])</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Phase in Degrees&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()),</span>
        <span class="n">yticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">540</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">):</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_SpectrumPhaseDelay.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_SpectrumPhaseDelay.png" />
</figure>
<p>The input has a unit magnitude and zero-phase Fourier transform, which is the reason
for the use as a test signal. The output has also unit magnitude but a linearly falling
phase with a slope of <span class="math notranslate nohighlight">\(-6\pi\)</span>. This is expected, since delaying a signal
<span class="math notranslate nohighlight">\(x(t)\)</span> by <span class="math notranslate nohighlight">\(\Delta t\)</span> produces an additional linear phase term in its
Fourier transform, i.e.,</p>
<div class="math notranslate nohighlight">
\[\int_\IR x(t-\Delta t) \e^{-\jj2\pi f t}\dd t =
X(f)\,  e^{-\jj2\pi \Delta t f}\ .\]</div>
<p>Note that in the plot the phase is not limited to the interval <span class="math notranslate nohighlight">\((+\pi, \pi]\)</span>
(output of <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.angle.html#numpy.angle" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">angle</span></code></a>) and hence does not have any discontinuities. This is
achieved by utilizing the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.unwrap.html#numpy.unwrap" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.unwrap</span></code></a> function. If the transfer function of
the filter is known, <a class="reference internal" href="../reference/generated/scipy.signal.freqz.html#scipy.signal.freqz" title="scipy.signal.freqz"><code class="xref py py-func docutils literal notranslate"><span class="pre">freqz</span></code></a> can be used to determine the spectral
response of a filter directly.</p>
</section>
<section id="spectra-with-averaging">
<h3>Spectra with Averaging<a class="headerlink" href="#spectra-with-averaging" title="Link to this heading">#</a></h3>
<p>The <a class="reference internal" href="../reference/generated/scipy.signal.periodogram.html#scipy.signal.periodogram" title="scipy.signal.periodogram"><code class="xref py py-func docutils literal notranslate"><span class="pre">periodogram</span></code></a> function calculates a power spectral density
(<code class="docutils literal notranslate"><span class="pre">scaling='density'</span></code>) or a squared magnitude spectrum (<code class="docutils literal notranslate"><span class="pre">scaling='spectrum'</span></code>). To
obtain a smoothed periodogram, the <a class="reference internal" href="../reference/generated/scipy.signal.welch.html#scipy.signal.welch" title="scipy.signal.welch"><code class="xref py py-func docutils literal notranslate"><span class="pre">welch</span></code></a> function can be used. It
does the smoothing by dividing the input signal into overlapping segments, to then
calculate the windowed DFT of each segment. The result is to the average of those DFTs.</p>
<p>The example below shows the squared magnitude spectrum and the power spectral density
of a signal made up of a <span class="math notranslate nohighlight">\(1.27\,\text{kHz}\)</span> sine signal with amplitude
<span class="math notranslate nohighlight">\(\sqrt{2}\,\text{V}\)</span> and additive gaussian noise having a spectral power density
with mean of <span class="math notranslate nohighlight">\(10^{-3}\,\text{V}^2/\text{Hz}\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">73625</span><span class="p">)</span>  <span class="c1"># seeding for reproducibility</span>

<span class="n">fs</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mf">10e3</span><span class="p">,</span> <span class="mi">10_000</span>
<span class="n">f_x</span><span class="p">,</span> <span class="n">noise_power</span> <span class="o">=</span> <span class="mi">1270</span><span class="p">,</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f_x</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">noise_power</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">fg</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Squared Magnitude Spectrum&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Square of Magnitude in V²&quot;</span><span class="p">)</span>
<span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Power Spectral Density&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Power Spectral Density in V²/Hz&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax_</span><span class="p">,</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axx</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">)):</span>
    <span class="n">f_p</span><span class="p">,</span> <span class="n">P_p</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">periodogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">s_</span><span class="p">)</span>
    <span class="n">f_w</span><span class="p">,</span> <span class="n">P_w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">s_</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f_p</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">P_p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Periodogram (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">f_p</span><span class="p">)</span><span class="si">}</span><span class="s2"> bins)&quot;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f_w</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">P_w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Welch&#39;s Method (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">f_w</span><span class="p">)</span><span class="si">}</span><span class="s2"> bins)&quot;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Frequency in kHz&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">))</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal_SpectralAnalysis_PeriodogramWelch.png" class="plot-directive" src="../_images/signal_SpectralAnalysis_PeriodogramWelch.png" />
</figure>
<p>The plots shows that the <a class="reference internal" href="../reference/generated/scipy.signal.welch.html#scipy.signal.welch" title="scipy.signal.welch"><code class="xref py py-func docutils literal notranslate"><span class="pre">welch</span></code></a> function produces a much smoother
noise floor at the expense of the frequency resolution. Due to the smoothing the height
of sine’s lobe is wider and not as high as in the periodogram. The left plot can be
used to read the height of the lobe, i.e., half sine’s squared magnitude of
<span class="math notranslate nohighlight">\(1\,\text{V}^2\)</span>. The right plot can be used to determine the noise floor of
<span class="math notranslate nohighlight">\(10^{-3}\,\text{V}^2/\text{Hz}\)</span>. Note that the lobe height of the averaged
squared magnitude spectrum is not exactly one due to limited frequency resolution.
Either zero-padding (e.g., passing <code class="docutils literal notranslate"><span class="pre">nfft=4*len(x)</span></code> to <a class="reference internal" href="../reference/generated/scipy.signal.welch.html#scipy.signal.welch" title="scipy.signal.welch"><code class="xref py py-func docutils literal notranslate"><span class="pre">welch</span></code></a>) or
reducing the number of segments by increasing the segment length (setting parameter
<code class="docutils literal notranslate"><span class="pre">nperseg</span></code>) could be utilized to increase the number of frequency bins.</p>
</section>
<section id="lomb-scargle-periodograms-lombscargle">
<h3>Lomb-Scargle Periodograms (<a class="reference internal" href="../reference/generated/scipy.signal.lombscargle.html#scipy.signal.lombscargle" title="scipy.signal.lombscargle"><code class="xref py py-func docutils literal notranslate"><span class="pre">lombscargle</span></code></a>)<a class="headerlink" href="#lomb-scargle-periodograms-lombscargle" title="Link to this heading">#</a></h3>
<p>Least-squares spectral analysis (LSSA) <a class="footnote-reference brackets" href="#lomb1976" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#scargle1982" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> is a method of
estimating a frequency spectrum, based on a least-squares fit of sinusoids to data
samples, similar to Fourier analysis. Fourier analysis, the most used spectral method in
science, generally boosts long-periodic noise in long-gapped records; LSSA
mitigates such problems.</p>
<p>The Lomb-Scargle method performs spectral analysis on unevenly-sampled data and
is known to be a powerful way to find, and test the significance of, weak
periodic signals.</p>
<p>For a time series comprising <span class="math notranslate nohighlight">\(N_{t}\)</span> measurements <span class="math notranslate nohighlight">\(X_{j}\equiv
X(t_{j})\)</span> sampled at times <span class="math notranslate nohighlight">\(t_{j}\)</span>, where <span class="math notranslate nohighlight">\((j = 1, \ldots, N_{t})\)</span>,
assumed to have been scaled and shifted, such that its mean is zero and its
variance is unity, the normalized Lomb-Scargle periodogram at frequency
<span class="math notranslate nohighlight">\(f\)</span> is</p>
<div class="math notranslate nohighlight">
\[P_{n}(f) = \frac{1}{2}\left\{\frac{\left[\sum_{j}^{N_{t}}X_{j}\cos\omega(t_{j}-\tau)\right]^{2}}{\sum_{j}^{N_{t}}\cos^{2}\omega(t_{j}-\tau)}+\frac{\left[\sum_{j}^{N_{t}}X_{j}\sin\omega(t_{j}-\tau)\right]^{2}}{\sum_{j}^{N_{t}}\sin^{2}\omega(t_{j}-\tau)}\right\}.\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\omega \equiv 2\pi f\)</span> is the angular frequency. The frequency-dependent
time offset <span class="math notranslate nohighlight">\(\tau\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\tan 2\omega\tau = \frac{\sum_{j}^{N_{t}}\sin 2\omega t_{j}}{\sum_{j}^{N_{t}}\cos 2\omega t_{j}}.\]</div>
<p>The <a class="reference internal" href="../reference/generated/scipy.signal.lombscargle.html#scipy.signal.lombscargle" title="scipy.signal.lombscargle"><code class="xref py py-func docutils literal notranslate"><span class="pre">lombscargle</span></code></a> function calculates the periodogram using a slightly
modified algorithm created by Zechmeister and Kürster <a class="footnote-reference brackets" href="#zechmeister2009" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>, which
allows for the weighting of individual samples and calculating an unknown offset
(also called a “floating-mean”) for each frequency independently.</p>
</section>
</section>
<section id="short-time-fourier-transform">
<span id="tutorial-stft"></span><h2>Short-Time Fourier Transform<a class="headerlink" href="#short-time-fourier-transform" title="Link to this heading">#</a></h2>
<p>This section gives some background information on using the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a>
class: The short-time Fourier transform (STFT) can be utilized to analyze the
spectral properties of signals over time. It divides a signal into overlapping
chunks by utilizing a sliding window and calculates the Fourier transform
of each chunk. For a continuous-time complex-valued signal <span class="math notranslate nohighlight">\(x(t)\)</span> the
STFT is defined <a class="footnote-reference brackets" href="#groechenig2001" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> as</p>
<div class="math notranslate nohighlight">
\[S(f, t) := \int_\IR x(\xi)\, \conj{w(\xi-t)}\,\e^{-\jj2\pi f \xi}\dd\xi\ ,\]</div>
<p>where <span class="math notranslate nohighlight">\(w(t)\)</span> is a complex-valued window function with its complex
conjugate being <span class="math notranslate nohighlight">\(\conj{w(t)}\)</span>. It can be interpreted as determining the
scalar product of <span class="math notranslate nohighlight">\(x\)</span> with the window <span class="math notranslate nohighlight">\(w\)</span> which is translated by
the time <span class="math notranslate nohighlight">\(t\)</span> and then modulated (i.e., frequency-shifted) by the
frequency <span class="math notranslate nohighlight">\(f\)</span>.
For working with sampled signals <span class="math notranslate nohighlight">\(x[k] := x(kT)\)</span>, <span class="math notranslate nohighlight">\(k\in\IZ\)</span>, with
sampling interval <span class="math notranslate nohighlight">\(T\)</span> (being the inverse of the sampling frequency <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.fs.html#scipy.signal.ShortTimeFFT.fs" title="scipy.signal.ShortTimeFFT.fs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fs</span></code></a>),
the discrete version, i.e., only evaluating the STFT at discrete grid points
<span class="math notranslate nohighlight">\(S[q, p] := S(q \Delta f, p\Delta t)\)</span>, <span class="math notranslate nohighlight">\(q,p\in\IZ\)</span>, needs to be
used. It can be formulated as</p>
<div class="math notranslate nohighlight" id="equation-eq-dstft">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-dstft" title="Link to this equation">#</a></span>\[S[q,p] = \sum_{k=0}^{N-1} x[k]\,\conj{w[k-p h]}\, \e^{-\jj2\pi q k / N}\ ,
          \quad q,p\in\IZ\ ,\]</div>
<p>with <em class="xref py py-obj">p</em> representing the time index of <span class="math notranslate nohighlight">\(S\)</span> with time interval
<span class="math notranslate nohighlight">\(\Delta t := h T\)</span>, <span class="math notranslate nohighlight">\(h\in\IN\)</span> (see <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.delta_t.html#scipy.signal.ShortTimeFFT.delta_t" title="scipy.signal.ShortTimeFFT.delta_t"><code class="xref py py-obj docutils literal notranslate"><span class="pre">delta_t</span></code></a>), which can be
expressed as the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.hop.html#scipy.signal.ShortTimeFFT.hop" title="scipy.signal.ShortTimeFFT.hop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hop</span></code></a> size of <span class="math notranslate nohighlight">\(h\)</span> samples. <span class="math notranslate nohighlight">\(q\)</span> represents the
frequency index of <span class="math notranslate nohighlight">\(S\)</span> with step size <span class="math notranslate nohighlight">\(\Delta f := 1 / (N T)\)</span>
(see <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.delta_f.html#scipy.signal.ShortTimeFFT.delta_f" title="scipy.signal.ShortTimeFFT.delta_f"><code class="xref py py-obj docutils literal notranslate"><span class="pre">delta_f</span></code></a>), which makes it FFT compatible. <span class="math notranslate nohighlight">\(w[m] := w(mT)\)</span>,
<span class="math notranslate nohighlight">\(m\in\IZ\)</span> is the sampled window function.</p>
<p>To be more aligned to the implementation of <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a>, it makes sense to
reformulate Eq. <a class="reference internal" href="#equation-eq-dstft">(7)</a> as a two-step process:</p>
<ol class="arabic">
<li><p>Extract the <span class="math notranslate nohighlight">\(p\)</span>-th slice by windowing with the window <span class="math notranslate nohighlight">\(w[m]\)</span>
made up of <span class="math notranslate nohighlight">\(M\)</span> samples (see <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.m_num.html#scipy.signal.ShortTimeFFT.m_num" title="scipy.signal.ShortTimeFFT.m_num"><code class="xref py py-obj docutils literal notranslate"><span class="pre">m_num</span></code></a>) centered
at <span class="math notranslate nohighlight">\(t[p] :=  p \Delta t = h T\)</span> (see <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.delta_t.html#scipy.signal.ShortTimeFFT.delta_t" title="scipy.signal.ShortTimeFFT.delta_t"><code class="xref py py-obj docutils literal notranslate"><span class="pre">delta_t</span></code></a>),
i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-windowing">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-stft-windowing" title="Link to this equation">#</a></span>\[x_p[m] = x\!\big[m - \lfloor M/2\rfloor + h p\big]\, \conj{w[m]}\ ,
         \quad m = 0, \ldots M-1\ ,\]</div>
<p>where the integer <span class="math notranslate nohighlight">\(\lfloor M/2\rfloor\)</span> represents <code class="docutils literal notranslate"><span class="pre">M//2</span></code>, i.e., it is
the mid point of the window (<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.m_num_mid.html#scipy.signal.ShortTimeFFT.m_num_mid" title="scipy.signal.ShortTimeFFT.m_num_mid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">m_num_mid</span></code></a>). For notational convenience,
<span class="math notranslate nohighlight">\(x[k]:=0\)</span> for <span class="math notranslate nohighlight">\(k\not\in\{0, 1, \ldots, N-1\}\)</span> is assumed. In the
subsection <a class="reference internal" href="#tutorial-stft-sliding-win"><span class="std std-ref">Sliding Windows</span></a> the indexing of the slices is
discussed in more detail.</p>
</li>
<li><p>Then perform a discrete Fourier transform (i.e., an
<a class="reference internal" href="fft.html#tutorial-fft"><span class="std std-ref">FFT</span></a>) of <span class="math notranslate nohighlight">\(x_p[m]\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-dft">
<span class="eqno">(9)<a class="headerlink" href="#equation-eq-stft-dft" title="Link to this equation">#</a></span>\[S[q, p] = \sum_{m=0}^{M-1} x_p[m] \exp\!\big\{%
                                 -2\jj\pi (q + \phi_m)\, m / M\big\}\ .\]</div>
<p>Note that a linear phase <span class="math notranslate nohighlight">\(\phi_m\)</span> (see <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.phase_shift.html#scipy.signal.ShortTimeFFT.phase_shift" title="scipy.signal.ShortTimeFFT.phase_shift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">phase_shift</span></code></a>) can be
specified, which corresponds to shifting the input by <span class="math notranslate nohighlight">\(\phi_m\)</span>
samples. The default is <span class="math notranslate nohighlight">\(\phi_m = \lfloor M/2\rfloor\)</span> (corresponds per
definition to <code class="docutils literal notranslate"><span class="pre">phase_shift</span> <span class="pre">=</span> <span class="pre">0</span></code>), which suppresses linear phase components
for unshifted signals.
Furthermore, the FFT may be oversampled by padding <span class="math notranslate nohighlight">\(w[m]\)</span> with zeros.
This can be achieved by specifying <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.mfft.html#scipy.signal.ShortTimeFFT.mfft" title="scipy.signal.ShortTimeFFT.mfft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mfft</span></code></a> to be larger than the window
length <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.m_num.html#scipy.signal.ShortTimeFFT.m_num" title="scipy.signal.ShortTimeFFT.m_num"><code class="xref py py-obj docutils literal notranslate"><span class="pre">m_num</span></code></a>—this sets <span class="math notranslate nohighlight">\(M\)</span> to <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.mfft.html#scipy.signal.ShortTimeFFT.mfft" title="scipy.signal.ShortTimeFFT.mfft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mfft</span></code></a> (implying that also
<span class="math notranslate nohighlight">\(w[m]:=0\)</span> for <span class="math notranslate nohighlight">\(m\not\in\{0, 1, \ldots, M-1\}\)</span> holds).</p>
</li>
</ol>
<p>The inverse short-time Fourier transform (<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.istft.html#scipy.signal.ShortTimeFFT.istft" title="scipy.signal.ShortTimeFFT.istft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">istft</span></code></a>) is implemented by reversing
these two steps:</p>
<ol class="arabic">
<li><p>Perform the inverse discrete Fourier transform, i.e.,</p>
<div class="math notranslate nohighlight">
\[x_p[m] = \frac{1}{M}\sum_{q=0}^M S[q, p]\, \exp\!\big\{
                                    2\jj\pi (q + \phi_m)\, m / M\big\}\ .\]</div>
</li>
<li><p>Sum the shifted slices weighted by <span class="math notranslate nohighlight">\(w_d[m]\)</span> to reconstruct the
original signal, i.e.,</p>
<div class="math notranslate nohighlight">
\[x[k] = \sum_p x_p\!\big[\mu_p(k)\big]\, w_d\!\big[\mu_p(k)\big]\ ,\quad
       \mu_p(k) = k + \lfloor M/2\rfloor - h p\]</div>
<p>for <span class="math notranslate nohighlight">\(k \in [0, \ldots, n-1]\)</span>. <span class="math notranslate nohighlight">\(w_d[m]\)</span> is the so-called
canonical dual window of <span class="math notranslate nohighlight">\(w[m]\)</span> and is also made up of <span class="math notranslate nohighlight">\(M\)</span>
samples.</p>
</li>
</ol>
<p>Note that an inverse STFT does not necessarily exist for all windows and hop sizes. For a given
window <span class="math notranslate nohighlight">\(w[m]\)</span> the hop size <span class="math notranslate nohighlight">\(h\)</span> must be small enough to ensure that
every sample of <span class="math notranslate nohighlight">\(x[k]\)</span> is touched by a non-zero value of at least one
window slice. This is sometimes referred as the “non-zero overlap condition”
(see <a class="reference internal" href="../reference/generated/scipy.signal.check_NOLA.html#scipy.signal.check_NOLA" title="scipy.signal.check_NOLA"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_NOLA</span></code></a>). Some more details are
given in the subsection <a class="reference internal" href="#tutorial-stft-dual-win"><span class="std std-ref">Inverse STFT and Dual Windows</span></a>.</p>
<section id="sliding-windows">
<span id="tutorial-stft-sliding-win"></span><h3>Sliding Windows<a class="headerlink" href="#sliding-windows" title="Link to this heading">#</a></h3>
<p>This subsection discusses how the sliding window is indexed in the
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> by means of an example: Consider a window of length 6 with a
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.hop.html#scipy.signal.ShortTimeFFT.hop" title="scipy.signal.ShortTimeFFT.hop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hop</span></code></a> interval of two and a sampling interval <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.T.html#scipy.signal.ShortTimeFFT.T" title="scipy.signal.ShortTimeFFT.T"><code class="xref py py-obj docutils literal notranslate"><span class="pre">T</span></code></a> of one, e.g., <code class="docutils literal notranslate"><span class="pre">ShortTimeFFT</span>
<span class="pre">(np.ones(6),</span> <span class="pre">2,</span> <span class="pre">fs=1)</span></code>. The following image schematically depicts the first
four window positions also named time slices:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/tutorial_stft_sliding_win_start.svg"><img alt="../_images/tutorial_stft_sliding_win_start.svg" src="../_images/tutorial_stft_sliding_win_start.svg" style="width: 60%;" />
</a>
</figure>
<p>The x-axis denotes the time <span class="math notranslate nohighlight">\(t\)</span>, which corresponds to the sample index
<em class="xref py py-obj">k</em> indicated by the bottom row of blue boxes. The y-axis denotes the time
slice index <span class="math notranslate nohighlight">\(p\)</span>. The signal <span class="math notranslate nohighlight">\(x[k]\)</span> starts at index <span class="math notranslate nohighlight">\(k=0\)</span> and
is marked by a light blue background. Per definition the zeroth slice
(<span class="math notranslate nohighlight">\(p=0\)</span>) is centered at <span class="math notranslate nohighlight">\(t=0\)</span>. The center of each slice
(<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.m_num_mid.html#scipy.signal.ShortTimeFFT.m_num_mid" title="scipy.signal.ShortTimeFFT.m_num_mid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">m_num_mid</span></code></a>), here being the sample <code class="docutils literal notranslate"><span class="pre">6//2=3</span></code>, is marked by the text “mid”.
By default the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.stft.html#scipy.signal.ShortTimeFFT.stft" title="scipy.signal.ShortTimeFFT.stft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stft</span></code></a> calculates all slices which have some overlap with the
signal. Hence the first slice is at <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.p_min.html#scipy.signal.ShortTimeFFT.p_min" title="scipy.signal.ShortTimeFFT.p_min"><code class="xref py py-obj docutils literal notranslate"><span class="pre">p_min</span></code></a> = -1 with the lowest sample index
being <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.k_min.html#scipy.signal.ShortTimeFFT.k_min" title="scipy.signal.ShortTimeFFT.k_min"><code class="xref py py-obj docutils literal notranslate"><span class="pre">k_min</span></code></a> = -5. The first sample index unaffected by a slice not sticking
out to the left of the signal is <span class="math notranslate nohighlight">\(p_{lb} = 2\)</span> and the first sample index
unaffected by border effects is <span class="math notranslate nohighlight">\(k_{lb} = 5\)</span>. The property
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.lower_border_end.html#scipy.signal.ShortTimeFFT.lower_border_end" title="scipy.signal.ShortTimeFFT.lower_border_end"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lower_border_end</span></code></a> returns the tuple <span class="math notranslate nohighlight">\((k_{lb}, p_{lb})\)</span>.</p>
<p>The behavior at the end of the signal is depicted for a signal with
<span class="math notranslate nohighlight">\(n=50\)</span> samples below, as indicated by the blue background:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/tutorial_stft_sliding_win_stop.svg"><img alt="../_images/tutorial_stft_sliding_win_stop.svg" src="../_images/tutorial_stft_sliding_win_stop.svg" style="width: 66%;" />
</a>
</figure>
<p>Here the last slice has index <span class="math notranslate nohighlight">\(p=26\)</span>.  Hence, following Python
convention of the end index being outside the range, <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.p_max.html#scipy.signal.ShortTimeFFT.p_max" title="scipy.signal.ShortTimeFFT.p_max"><code class="xref py py-obj docutils literal notranslate"><span class="pre">p_max</span></code></a> = 27 indicates the
first slice not touching the signal. The corresponding sample index is
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.k_max.html#scipy.signal.ShortTimeFFT.k_max" title="scipy.signal.ShortTimeFFT.k_max"><code class="xref py py-obj docutils literal notranslate"><span class="pre">k_max</span></code></a> = 55. The first slice, which sticks out to the right is
<span class="math notranslate nohighlight">\(p_{ub} = 24\)</span> with its first sample at <span class="math notranslate nohighlight">\(k_{ub}=45\)</span>. The function
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.upper_border_begin.html#scipy.signal.ShortTimeFFT.upper_border_begin" title="scipy.signal.ShortTimeFFT.upper_border_begin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">upper_border_begin</span></code></a> returns the tuple <span class="math notranslate nohighlight">\((k_{ub}, p_{ub})\)</span>.</p>
</section>
<section id="inverse-stft-and-dual-windows">
<span id="tutorial-stft-dual-win"></span><h3>Inverse STFT and Dual Windows<a class="headerlink" href="#inverse-stft-and-dual-windows" title="Link to this heading">#</a></h3>
<p>The term dual window stems from frame theory <a class="footnote-reference brackets" href="#christensen2016" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a> where a frame is a
series expansion which can represent any function in a given Hilbert space. There the
expansions <span class="math notranslate nohighlight">\(\{g_k\}\)</span> and <span class="math notranslate nohighlight">\(\{h_k\}\)</span> are dual frames if for all
functions <span class="math notranslate nohighlight">\(f\)</span> in the given Hilbert space <span class="math notranslate nohighlight">\(\mathcal{H}\)</span></p>
<div class="math notranslate nohighlight">
\[f  = \sum_{k\in\IN} \langle f, g_k\rangle h_k
   =  \sum_{k\in\IN} \langle f, h_k\rangle g_k\ , \quad f \in \mathcal{H}\ ,\]</div>
<p>holds, where <span class="math notranslate nohighlight">\(\langle ., .\rangle\)</span> denotes the scalar product of
<span class="math notranslate nohighlight">\(\mathcal{H}\)</span>. All frames have dual frames <a class="footnote-reference brackets" href="#christensen2016" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>.</p>
<p>An STFT evaluated only at discrete grid
points <span class="math notranslate nohighlight">\(S(q \Delta f, p\Delta t)\)</span> is called  a “Gabor frame” in
literature <a class="footnote-reference brackets" href="#groechenig2001" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#christensen2016" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>.
Since the support of the window <span class="math notranslate nohighlight">\(w[m]\)</span> is limited to a finite interval,
the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> falls into the class of the so-called “painless
non-orthogonal expansions” <a class="footnote-reference brackets" href="#groechenig2001" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>. In this case the dual windows always
have the same support and can be calculated by means of inverting a diagonal matrix. A
rough derivation only requiring some understanding of manipulating matrices
will be sketched out in the following:</p>
<p>Since the STFT given in Eq. <a class="reference internal" href="#equation-eq-dstft">(7)</a> is a linear mapping in
<span class="math notranslate nohighlight">\(x[k]\)</span>, it can be expressed in vector-matrix notation. This allows us to
express the inverse via the formal solution of the linear least squares method
(as in <a class="reference internal" href="../reference/generated/scipy.linalg.lstsq.html#scipy.linalg.lstsq" title="scipy.linalg.lstsq"><code class="xref py py-func docutils literal notranslate"><span class="pre">lstsq</span></code></a>), which leads to a beautiful and simple result.</p>
<p>We begin by reformulating the windowing of Eq. <a class="reference internal" href="#equation-eq-stft-windowing">(8)</a></p>
<div class="math notranslate nohighlight" id="equation-eq-stft-winmatrix">
<span class="eqno">(10)<a class="headerlink" href="#equation-eq-stft-winmatrix" title="Link to this equation">#</a></span>\[\begin{split}  \vb{x}_p  = \vb{W}_{\!p}\,\vb{x} =
  \begin{bmatrix}
    \cdots &amp; 0 &amp; w[0]   &amp; 0 &amp; \cdots&amp;&amp;&amp;\\
    &amp; \cdots  &amp; 0 &amp; w[1] &amp; 0 &amp; \cdots&amp;&amp;\\
    &amp;   &amp;   &amp;         &amp; \ddots&amp;&amp;&amp;\\
    &amp;&amp;\cdots &amp; 0 &amp; 0 &amp; w[M-1] &amp; 0 &amp; \cdots
  \end{bmatrix}\begin{bmatrix}
    x[0]\\ x[1]\\ \vdots\\ x[N-1]
  \end{bmatrix}\ ,\end{split}\]</div>
<p>where the <span class="math notranslate nohighlight">\(M\times N\)</span> matrix <span class="math notranslate nohighlight">\(\vb{W}_{\!p}\)</span> has only non-zeros
entries on the <span class="math notranslate nohighlight">\((ph)\)</span>-th minor diagonal, i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-winmatrix1">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq-stft-winmatrix1" title="Link to this equation">#</a></span>\[\begin{split}    W_p[m,k] = w[m]\, \delta_{m+ph,k}\ ,\quad
   \delta_{k,l} &amp;= \begin{cases} 1 &amp; \text{ for } k=l\ ,\\
                                0 &amp; \text{ elsewhere ,} \end{cases}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(\delta_{k,l}\)</span> being the Kronecker Delta.
Eq. <a class="reference internal" href="#equation-eq-stft-dft">(9)</a> can be expressed as</p>
<div class="math notranslate nohighlight">
\[\vb{s}_p = \vb{F}\,\vb{x}_p \quad\text{with}\quad
F[q,m] =\exp\!\big\{-2\jj\pi (q + \phi_m)\, m / M\big\}\ ,\]</div>
<p>which allows the STFT of the <span class="math notranslate nohighlight">\(p\)</span>-th slice to be written as</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-slice-p">
<span class="eqno">(12)<a class="headerlink" href="#equation-eq-stft-slice-p" title="Link to this equation">#</a></span>\[\vb{s}_p = \vb{F}\vb{W}_{\!p}\,\vb{x} =: \vb{G}_p\,\vb{x}
\quad\text{with}\quad s_p[q] = S[p,q]\ .\]</div>
<p>Note that <span class="math notranslate nohighlight">\(\vb{F}\)</span> is unitary, i.e., the inverse equals its conjugate
transpose meaning <span class="math notranslate nohighlight">\(\conjT{\vb{F}}\vb{F} = \vb{I}\)</span>.</p>
<p>To obtain a single vector-matrix equation for the STFT, the slices are stacked
into one vector, i.e.,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\vb{s} := \begin{bmatrix}
           \vb{s}_0\\ \vb{s}_1\\ \vdots\\ \vb{s}_{P-1}
          \end{bmatrix}
      = \begin{bmatrix}
           \vb{G}_0\\ \vb{G}_1\\ \vdots\\ \vb{G}_{P-1}
        \end{bmatrix}\, \vb{x}
      =:  \vb{G}\, \vb{x}\ ,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(P\)</span> is the number of columns of the resulting STFT. To invert this
equation the Moore-Penrose inverse <span class="math notranslate nohighlight">\(\vb{G}^\dagger\)</span> can be utilized</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-moorepenrose">
<span class="eqno">(13)<a class="headerlink" href="#equation-eq-stft-moorepenrose" title="Link to this equation">#</a></span>\[\vb{x} = \inv{\conjT{\vb{G}}\vb{G}}\, \conjT{\vb{G}} \vb{s}
       =: \vb{G}^\dagger \vb{s}\ ,\]</div>
<p>which exists if</p>
<div class="math notranslate nohighlight">
\[\begin{split}\vb{D} := \conjT{\vb{G}}\vb{G} =
    \begin{bmatrix}
        \conjT{\vb{G}_0}&amp; \conjT{\vb{G}_1}&amp; \cdots &amp;  \conjT{\vb{G}_{P-1}}
    \end{bmatrix}^T \begin{bmatrix}
        \vb{G}_0\\ \vb{G}_1\\ \vdots\\ \vb{G}_{P-1}
    \end{bmatrix}
  = \sum_{p=0}^{P-1} \conjT{\vb{G}_p}\vb{G}_p \ .\end{split}\]</div>
<p>is invertible. Then <span class="math notranslate nohighlight">\(\vb{x} = \vb{G}^\dagger\vb{G}\,\vb{x} =
\inv{\conjT{\vb{G}}\vb{G}}\,\conjT{\vb{G}}\vb{G}\,\vb{x}\)</span> obviously holds.
<span class="math notranslate nohighlight">\(\vb{D}\)</span> is always a diagonal matrix with non-negative diagonal entries.
This becomes clear, when simplifying <span class="math notranslate nohighlight">\(\vb{D}\)</span> further to</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-diagm2">
<span class="eqno">(14)<a class="headerlink" href="#equation-eq-stft-diagm2" title="Link to this equation">#</a></span>\[\vb{D} = \sum_{p=0}^{P-1} \conjT{\vb{G}_p}\vb{G}_p
       = \sum_{p=0}^{P-1} \conjT{(\vb{F}\,\vb{W}_{\!p})}\,
                          \vb{F}\,\vb{W}_{\!p}
       = \sum_{p=0}^{P-1} \conjT{\vb{W}_{\!p}}\vb{W}_{\!p}
       =: \sum_{p=0}^{P-1} \vb{D}_p\]</div>
<p>due to <span class="math notranslate nohighlight">\(\vb{F}\)</span> being unitary. Furthermore</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-diagm3">
<span class="eqno">(15)<a class="headerlink" href="#equation-eq-stft-diagm3" title="Link to this equation">#</a></span>\[\begin{split}D_p[r,s] &amp;= \sum_{m=0}^{M-1} \conj{W_p^T[r,m]}\,W_p[m,s]
          = \sum_{m=0}^{M-1} \left(\conj{w[m]}\, \delta_{m+ph,r}\right)
                             \left(w[m]\, \delta_{m+ph,s}\right)\\
         &amp;= \sum_{m=0}^{M-1} \big|w[m]\big|^2\,
                             \delta_{r,s}\, \delta_{r,m+ph}\ .\end{split}\]</div>
<p>shows that <span class="math notranslate nohighlight">\(\vb{D}_p\)</span> is a diagonal matrix with non-negative entries.
Hence, summing <span class="math notranslate nohighlight">\(\vb{D}_p\)</span> preserves that property. This allows to
simplify Eq. <a class="reference internal" href="#equation-eq-stft-moorepenrose">(13)</a> further, i.e.,</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-istftm">
<span class="eqno">(16)<a class="headerlink" href="#equation-eq-stft-istftm" title="Link to this equation">#</a></span>\[\begin{split}\vb{x} &amp;= \vb{D}^{-1} \conjT{\vb{G}}\vb{s}
        = \sum_{p=0}^{P-1} \vb{D}^{-1}\conjT{\vb{W}_{\!p}}\,
                           \conjT{\vb{F}}\vb{s}_p
        =  \sum_{p=0}^{P-1} (\conj{\vb{W}_{\!p}\vb{D}^{-1}})^T\,
                            \conjT{\vb{F}}\vb{s}_p\\
       &amp;=: \sum_{p=0}^{P-1}\conjT{\vb{U}_p}\,\conjT{\vb{F}}\vb{s}_p\ .\end{split}\]</div>
<p>Utilizing Eq. <a class="reference internal" href="#equation-eq-stft-winmatrix1">(11)</a>, <a class="reference internal" href="#equation-eq-stft-diagm2">(14)</a>,
<a class="reference internal" href="#equation-eq-stft-diagm3">(15)</a>, <span class="math notranslate nohighlight">\(\vb{U}_p=\vb{W}_{\!p}\vb{D}^{-1}\)</span> can be
expressed as</p>
<div class="math notranslate nohighlight" id="equation-eq-stft-dualwinm">
<span class="eqno">(17)<a class="headerlink" href="#equation-eq-stft-dualwinm" title="Link to this equation">#</a></span>\[\begin{split}U_p[m, k] &amp;= W[m,k]\, D^{-1}[k,k]
           = \left(w[m] \delta_{m+ph,k}\right)
             \inv{\sum_{\eta=0}^{P-1}  \vb{D}_\eta[k,k]} \delta_{m+ph,k}\\
           &amp;= w[m] \inv{\sum_{\eta=0}^{P-1}\sum_{\mu=0}^{M-1}
                             \big|w[\mu]\big|^2\,\delta_{m+ph, \mu+\eta h}}
                   \delta_{m+ph,k}\\
            &amp;= w[m] \inv{\sum_{\eta=0}^{P-1} \big|w[m+(p-\eta)h]\big|^2}
                   \delta_{m+ph,k} \ .\end{split}\]</div>
<p>This shows <span class="math notranslate nohighlight">\(\vb{U}_p\)</span> has the identical structure as <span class="math notranslate nohighlight">\(\vb{W}_p\)</span>
in Eq. <a class="reference internal" href="#equation-eq-stft-winmatrix1">(11)</a>, i.e., having only non-zero
entries on the <span class="math notranslate nohighlight">\((ph)\)</span>-th minor diagonal. The sum term in the inverse can
be interpreted as sliding <span class="math notranslate nohighlight">\(|w[\mu]|^2\)</span> over <span class="math notranslate nohighlight">\(w[m]\)</span> (with an
incorporated inversion), so only components overlapping with <span class="math notranslate nohighlight">\(w[m]\)</span> have
an effect. Hence, all <span class="math notranslate nohighlight">\(U_p[m, k]\)</span> far enough from the border are
identical windows. To circumvent border effects, <span class="math notranslate nohighlight">\(x[k]\)</span> is padded with
zeros, enlarging <span class="math notranslate nohighlight">\(\vb{U}\)</span> so all slices which touch <span class="math notranslate nohighlight">\(x[k]\)</span> contain
the identical dual window</p>
<div class="math notranslate nohighlight">
\[w_d[m] = w[m] \inv{\sum_{\eta\in\IZ} \big|w[m + \eta\, h]\big|^2}\ .\]</div>
<p>Since <span class="math notranslate nohighlight">\(w[m] = 0\)</span> holds for <span class="math notranslate nohighlight">\(m \not\in\{0, \ldots, M-1\}\)</span>, it is
only required to sum over the indexes <span class="math notranslate nohighlight">\(\eta\)</span> fulfilling
<span class="math notranslate nohighlight">\(|\eta| &lt; M/h\)</span>. The name dual window can be justified by inserting Eq.
<a class="reference internal" href="#equation-eq-stft-slice-p">(12)</a> into Eq. <a class="reference internal" href="#equation-eq-stft-istftm">(16)</a>, i.e.,</p>
<div class="math notranslate nohighlight">
\[\vb{x} = \sum_{p=0}^{P-1} \conjT{\vb{U}_p}\,\conjT{\vb{F}}\,
                                             \vb{F}\,\vb{W}_{\!p}\,\vb{x}
    = \left(\sum_{p=0}^{P-1} \conjT{\vb{U}_p}\,\vb{W}_{\!p}\right)\vb{x}\ ,\]</div>
<p>showing that <span class="math notranslate nohighlight">\(\vb{U}_p\)</span> and <span class="math notranslate nohighlight">\(\vb{W}_{\!p}\)</span> are interchangeable.
Hence, <span class="math notranslate nohighlight">\(w_d[m]\)</span> is also a valid window with dual window <span class="math notranslate nohighlight">\(w[m]\)</span>.
Note that <span class="math notranslate nohighlight">\(w_d[m]\)</span> is not a unique dual window, due to <span class="math notranslate nohighlight">\(\vb{s}\)</span>
typically having more entries than <span class="math notranslate nohighlight">\(\vb{x}\)</span>. It can be shown, that
<span class="math notranslate nohighlight">\(w_d[m]\)</span> has the minimal energy (or <span class="math notranslate nohighlight">\(L_2\)</span> norm) <a class="footnote-reference brackets" href="#groechenig2001" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>,
which is the reason for being named the  “canonical dual window”.</p>
</section>
<section id="comparison-with-legacy-implementation">
<span id="tutorial-stft-legacy-stft"></span><h3>Comparison with Legacy Implementation<a class="headerlink" href="#comparison-with-legacy-implementation" title="Link to this heading">#</a></h3>
<p>The functions <a class="reference internal" href="../reference/generated/scipy.signal.stft.html#scipy.signal.stft" title="scipy.signal.stft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stft</span></code></a>, <a class="reference internal" href="../reference/generated/scipy.signal.istft.html#scipy.signal.istft" title="scipy.signal.istft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">istft</span></code></a>, and the <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> predate the
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> implementation. This section discusses the key differences
between the older “legacy” and the newer <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> implementations. The
main motivation for a rewrite was the insight that integrating <a class="reference internal" href="#tutorial-stft-dual-win"><span class="std std-ref">dual
windows</span></a> could not be done in a sane way without
breaking compatibility. This opened the opportunity for rethinking the code
structure and the parametrization, thus making some implicit behavior more
explicit.</p>
<p>The following example compares the two STFTs of a complex valued chirp signal
with a negative slope:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fftshift</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">stft</span><span class="p">,</span> <span class="n">istft</span><span class="p">,</span> <span class="n">spectrogram</span><span class="p">,</span> <span class="n">ShortTimeFFT</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1001</span>  <span class="c1"># 200 Hz sampling rate for 5 s signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>  <span class="c1"># time indexes for signal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">70</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_z</span> <span class="o">-</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">t_z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># complex-valued chirp</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">win</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># Gaussian with 0.01 s standard dev.</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Legacy STFT:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f0_u</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">Sz0_u</span> <span class="o">=</span> <span class="n">stft</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="n">return_onesided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;spectrum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f0</span><span class="p">,</span> <span class="n">Sz0</span> <span class="o">=</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">f0_u</span><span class="p">),</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">Sz0_u</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># New STFT:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SFT</span> <span class="o">=</span> <span class="n">ShortTimeFFT</span><span class="o">.</span><span class="n">from_window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span> <span class="n">fft_mode</span><span class="o">=</span><span class="s1">&#39;centered&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">scale_to</span><span class="o">=</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span> <span class="n">phase_shift</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sz1</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Plot results:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig1</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="gp">... </span>                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">))</span>  <span class="c1"># enlarge figure a bit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_lo</span><span class="p">,</span> <span class="n">t_hi</span><span class="p">,</span> <span class="n">f_lo</span><span class="p">,</span> <span class="n">f_hi</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">extent</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">center_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Legacy stft() produces $</span><span class="si">%d</span><span class="s2">\times</span><span class="si">%d</span><span class="s2">$ points&quot;</span> <span class="o">%</span> <span class="n">Sz0</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t_lo</span><span class="p">,</span> <span class="n">t_hi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">f_lo</span><span class="p">,</span> <span class="n">f_hi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ShortTimeFFT produces $</span><span class="si">%d</span><span class="s2">\times</span><span class="si">%d</span><span class="s2">$ points&quot;</span> <span class="o">%</span> <span class="n">Sz1</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Time $t$ in seconds ($\Delta t= </span><span class="si">{</span><span class="n">SFT</span><span class="o">.</span><span class="n">delta_t</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">\,$s)&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate extent of plot with centered bins since</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># imshow does not interpolate by default:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">nperseg</span><span class="o">-</span><span class="n">noverlap</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># equals SFT.delta_t / 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">/</span> <span class="n">nperseg</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># equals SFT.delta_f / 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extent0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">dt2</span><span class="p">,</span> <span class="n">t0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt2</span><span class="p">,</span> <span class="n">f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">df2</span><span class="p">,</span> <span class="n">f0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extent1</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">extent</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">center_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im1a</span> <span class="o">=</span> <span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Sz0</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent0</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im1b</span> <span class="o">=</span> <span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Sz1</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent1</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig1</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1b</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Magnitude $|S_z(t, f)|$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">fig1</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Frequency $f$ in Hertz ($\Delta f = </span><span class="si">%g</span><span class="s2">\,$Hz)&quot;</span> <span class="o">%</span>
<span class="gp">... </span>                   <span class="n">SFT</span><span class="o">.</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/signal-9.png" class="plot-directive" src="../_images/signal-9.png" />
</figure>
<p>That the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> produces 3 more time slices than the legacy version is
the main difference. As laid out in the <a class="reference internal" href="#tutorial-stft-sliding-win"><span class="std std-ref">Sliding Windows</span></a>
section, all slices which touch the signal are incorporated in the new version.
This has the advantage that the STFT can be sliced and reassembled as shown in
the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> code example. Furthermore, using all touching slices makes
the ISTFT more robust in the case of windows that are zero somewhere.</p>
<p>Note that the slices with identical time stamps produce equal results
(up to numerical accuracy), i.e.:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">Sz0</span><span class="p">,</span> <span class="n">Sz1</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Generally, those additional slices contain non-zero values. Due to the
large overlap in our example, they are quite small. E.g.:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">abs</span><span class="p">(</span><span class="n">Sz1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Sz1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="go">(6.925060911593139e-07, 8.00271269218721e-07)</span>
</pre></div>
</div>
<p>The ISTFT can be utilized to reconstruct the original signal:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t0_r</span><span class="p">,</span> <span class="n">z0_r</span> <span class="o">=</span> <span class="n">istft</span><span class="p">(</span><span class="n">Sz0_u</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">input_onesided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;spectrum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z1_r</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">istft</span><span class="p">(</span><span class="n">Sz1</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">z0_r</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">(1010, 1001)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">z0_r</span><span class="p">[:</span><span class="n">N</span><span class="p">],</span> <span class="n">z</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">z1_r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Note that the legacy implementation returns a signal which is longer than the
original. On the other hand, the new <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.istft.html#scipy.signal.ShortTimeFFT.istft" title="scipy.signal.ShortTimeFFT.istft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">istft</span></code></a> allows to explicitly specify the
start index <em class="xref py py-obj">k0</em> and the end index <em class="xref py py-obj">k1</em> of the reconstructed signal. The length
discrepancy in the old implementation is caused by the fact that the signal
length is not a multiple of the slices.</p>
<p>Further differences between the new and legacy versions in this example are:</p>
<ul class="simple">
<li><p>The parameter <code class="docutils literal notranslate"><span class="pre">fft_mode='centered'</span></code> ensures that the zero frequency is
vertically centered for two-sided FFTs in the plot. With the legacy
implementation, <a class="reference internal" href="../reference/generated/scipy.fft.fftshift.html#scipy.fft.fftshift" title="scipy.fft.fftshift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fftshift</span></code></a> needs to be utilized.
<code class="docutils literal notranslate"><span class="pre">fft_mode='twosided'</span></code> produces the same behavior as the old version.</p></li>
<li><p>The parameter <code class="docutils literal notranslate"><span class="pre">phase_shift=None</span></code> ensures identical phases of the two
versions. <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a>’s default value of <code class="docutils literal notranslate"><span class="pre">0</span></code> produces STFT slices
with an additional linear phase term.</p></li>
</ul>
<p>A spectrogram is defined as the absolute square of the STFT <a class="footnote-reference brackets" href="#groechenig2001" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>. The
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.spectrogram.html#scipy.signal.ShortTimeFFT.spectrogram" title="scipy.signal.ShortTimeFFT.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> provided by the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> sticks to that definition, i.e.:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">SFT</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Sz1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>On the other hand, the legacy <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> provides another STFT
implementation with the key difference being the different handling of the
signal borders. The following example shows how to use the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> to
obtain an identical SFT as produced with the legacy <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Legacy spectrogram (detrending for complex signals not useful):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f2_u</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">Sz2_u</span> <span class="o">=</span> <span class="n">spectrogram</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="n">detrend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_onesided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span><span class="p">,</span> <span class="n">Sz2</span> <span class="o">=</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">f2_u</span><span class="p">),</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">Sz2_u</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># New STFT:</span>
<span class="gp">... </span><span class="n">SFT</span> <span class="o">=</span> <span class="n">ShortTimeFFT</span><span class="o">.</span><span class="n">from_window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">fft_mode</span><span class="o">=</span><span class="s1">&#39;centered&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">scale_to</span><span class="o">=</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span> <span class="n">phase_shift</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sz3</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">noverlap</span><span class="p">)</span><span class="o">//</span><span class="n">SFT</span><span class="o">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">k_offset</span><span class="o">=</span><span class="n">nperseg</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">SFT</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">noverlap</span><span class="p">)</span><span class="o">//</span><span class="n">SFT</span><span class="o">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">k_offset</span><span class="o">=</span><span class="n">nperseg</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">SFT</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">Sz2</span><span class="p">,</span> <span class="n">Sz3</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The difference from the other STFTs is that the time slices do not start at 0 but
at <code class="docutils literal notranslate"><span class="pre">nperseg//2</span></code>, i.e.:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span>
<span class="go">array([0.125, 0.175, 0.225, 0.275, 0.325, 0.375, 0.425, 0.475, 0.525,</span>
<span class="go">       ...</span>
<span class="go">       4.625, 4.675, 4.725, 4.775, 4.825, 4.875])</span>
</pre></div>
</div>
<p>Furthermore, only slices which do not stick out to the right are returned,
centering the last slice at 4.875 s, which makes it shorter than with the default
<a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.stft.html#scipy.signal.ShortTimeFFT.stft" title="scipy.signal.ShortTimeFFT.stft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stft</span></code></a> parametrization.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">mode</span></code> parameter, the legacy <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> can also return the
‘angle’, ‘phase’, ‘psd’ or the ‘magnitude’. The <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.scaling.html#scipy.signal.ShortTimeFFT.scaling" title="scipy.signal.ShortTimeFFT.scaling"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scaling</span></code></a> behavior of the
legacy <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> is not straightforward, since it depends on the
parameters <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">scaling</span></code> and <code class="docutils literal notranslate"><span class="pre">return_onesided</span></code>. There is no direct
correspondence for all combinations in the <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a>, since it provides
only ‘magnitude’, ‘psd’ or no <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.scaling.html#scipy.signal.ShortTimeFFT.scaling" title="scipy.signal.ShortTimeFFT.scaling"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scaling</span></code></a> of the window at all. The following
table shows those correspondences:</p>
<div class="pst-scrollable-table-container"><table class="table-sm table">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Legacy <a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a></p></th>
<th class="head"></th>
<th class="head" colspan="2"><p><a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a></p></th>
</tr>
<tr class="row-even"><th class="head"><p>mode</p></th>
<th class="head"><p>scaling</p></th>
<th class="head"><p>return_onesided</p></th>
<th class="head"></th>
<th class="head"><p><a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.fft_mode.html#scipy.signal.ShortTimeFFT.fft_mode" title="scipy.signal.ShortTimeFFT.fft_mode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fft_mode</span></code></a></p></th>
<th class="head"><p><a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.scaling.html#scipy.signal.ShortTimeFFT.scaling" title="scipy.signal.ShortTimeFFT.scaling"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scaling</span></code></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>psd</p></td>
<td><p>density</p></td>
<td><p>True</p></td>
<td></td>
<td><p>onesided2X</p></td>
<td><p>psd</p></td>
</tr>
<tr class="row-even"><td><p>psd</p></td>
<td><p>density</p></td>
<td><p>False</p></td>
<td></td>
<td><p>twosided</p></td>
<td><p>psd</p></td>
</tr>
<tr class="row-odd"><td><p>magnitude</p></td>
<td><p>spectrum</p></td>
<td><p>True</p></td>
<td></td>
<td><p>onesided</p></td>
<td><p>magnitude</p></td>
</tr>
<tr class="row-even"><td><p>magnitude</p></td>
<td><p>spectrum</p></td>
<td><p>False</p></td>
<td></td>
<td><p>twosided</p></td>
<td><p>magnitude</p></td>
</tr>
<tr class="row-odd"><td><p>complex</p></td>
<td><p>spectrum</p></td>
<td><p>True</p></td>
<td></td>
<td><p>onesided</p></td>
<td><p>magnitude</p></td>
</tr>
<tr class="row-even"><td><p>complex</p></td>
<td><p>spectrum</p></td>
<td><p>False</p></td>
<td></td>
<td><p>twosided</p></td>
<td><p>magnitude</p></td>
</tr>
<tr class="row-odd"><td><p>psd</p></td>
<td><p>spectrum</p></td>
<td><p>True</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-even"><td><p>psd</p></td>
<td><p>spectrum</p></td>
<td><p>False</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-odd"><td><p>complex</p></td>
<td><p>density</p></td>
<td><p>True</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-even"><td><p>complex</p></td>
<td><p>density</p></td>
<td><p>False</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-odd"><td><p>magnitude</p></td>
<td><p>density</p></td>
<td><p>True</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-even"><td><p>magnitude</p></td>
<td><p>density</p></td>
<td><p>False</p></td>
<td></td>
<td><p>—</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-odd"><td><p>—</p></td>
<td><p>—</p></td>
<td><p>—</p></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">onesided</span></code> output on complex-valued input signals, the old
<a class="reference internal" href="../reference/generated/scipy.signal.spectrogram.html#scipy.signal.spectrogram" title="scipy.signal.spectrogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spectrogram</span></code></a> switches to <code class="docutils literal notranslate"><span class="pre">two-sided</span></code> mode. The <a class="reference internal" href="../reference/generated/scipy.signal.ShortTimeFFT.html#scipy.signal.ShortTimeFFT" title="scipy.signal.ShortTimeFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFFT</span></code></a> raises
a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.13)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>, since the utilized <a class="reference internal" href="../reference/generated/scipy.fft.rfft.html#scipy.fft.rfft" title="scipy.fft.rfft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rfft</span></code></a> function only accepts
real-valued inputs. Consult the <a class="reference internal" href="#tutorial-spectralanalysis"><span class="std std-ref">Spectral Analysis</span></a> section above for a
discussion on the various spectral representations which are induced by the various
parameterizations.</p>
<p class="rubric">References</p>
<p>Some further reading and related software:</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="wiki-ft" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>“Fourier transform”, Wikipedia,
<a class="reference external" href="https://en.wikipedia.org/wiki/Fourier_transform">https://en.wikipedia.org/wiki/Fourier_transform</a></p>
</aside>
<aside class="footnote brackets" id="wiki-spectd" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>“Spectral density”, Wikipedia,
<a class="reference external" href="https://en.wikipedia.org/wiki/Spectral_density">https://en.wikipedia.org/wiki/Spectral_density</a></p>
</aside>
<aside class="footnote brackets" id="wiki-dft" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>“Discrete Fourier transform”, Wikipedia,
<a class="reference external" href="https://en.wikipedia.org/wiki/Discrete_Fourier_transform">https://en.wikipedia.org/wiki/Discrete_Fourier_transform</a></p>
</aside>
<aside class="footnote brackets" id="wiki-spectralleakage" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>“Spectral Leakage”, Wikipedia,
<a class="reference external" href="https://en.wikipedia.org/wiki/Spectral_leakage">https://en.wikipedia.org/wiki/Spectral_leakage</a></p>
</aside>
<aside class="footnote brackets" id="wiki-nyqistshannon" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>“Nyquist–Shannon sampling theorem”,  Wikipedia,
<a class="reference external" href="https://en.wikipedia.org/wiki/Nyquist-Shannon_sampling_theorem">https://en.wikipedia.org/wiki/Nyquist-Shannon_sampling_theorem</a></p>
</aside>
<aside class="footnote brackets" id="lomb1976" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>N.R. Lomb “Least-squares frequency analysis of unequally spaced
data”, Astrophysics and Space Science, vol 39, pp. 447-462, 1976</p>
</aside>
<aside class="footnote brackets" id="scargle1982" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>J.D. Scargle “Studies in astronomical time series analysis. II -
Statistical aspects of spectral analysis of unevenly spaced data”,
The Astrophysical Journal, vol 263, pp. 835-853, 1982</p>
</aside>
<aside class="footnote brackets" id="zechmeister2009" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>M. Zechmeister and M. Kürster, “The generalised Lomb-Scargle
periodogram. A new formalism for the floating-mean and Keplerian
periodograms,” Astronomy and Astrophysics, vol. 496, pp. 577-584, 2009</p>
</aside>
<aside class="footnote brackets" id="groechenig2001" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id9">1</a>,<a role="doc-backlink" href="#id12">2</a>,<a role="doc-backlink" href="#id14">3</a>,<a role="doc-backlink" href="#id15">4</a>,<a role="doc-backlink" href="#id16">5</a>)</span>
<p>Karlheinz Gröchenig: “Foundations of Time-Frequency Analysis”,
Birkhäuser Boston 2001, <a class="reference external" href="https://doi.org/10.1007/978-1-4612-0003-1">DOI:10.1007/978-1-4612-0003-1</a></p>
</aside>
<aside class="footnote brackets" id="christensen2016" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id10">1</a>,<a role="doc-backlink" href="#id11">2</a>,<a role="doc-backlink" href="#id13">3</a>)</span>
<p>Ole Christensen: “An Introduction to Frames and Riesz Bases”,
Birkhäuser Boston 2016, <a class="reference external" href="https://doi.org/10.1007/978-3-319-25613-9">DOI:10.1007/978-3-319-25613-9</a></p>
</aside>
</aside>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="fft.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fourier Transforms (<code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.fft</span></code>)</p>
      </div>
    </a>
    <a class="right-next"
       href="linalg.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linear Algebra (<code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.linalg</span></code>)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#b-splines">B-splines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering">Filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution-correlation">Convolution/Correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#difference-equation-filtering">Difference-equation filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-linear-systems">Analysis of Linear Systems</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-design">Filter Design</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fir-filter">FIR Filter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#iir-filter">IIR Filter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-coefficients">Filter Coefficients</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-function-representation">Transfer function representation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#zeros-and-poles-representation">Zeros and poles representation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#state-space-system-representation">State-space system representation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-sections-representation">Second-order sections representation</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-transformations">Filter transformations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-filters">Other filters</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#median-filter">Median Filter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#order-filter">Order Filter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#wiener-filter">Wiener filter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hilbert-filter">Hilbert filter</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analog-filter-design">Analog Filter Design</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-analysis">Spectral Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-time-sine-signal">Continuous-time Sine Signal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sampled-sine-signal">Sampled Sine Signal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phase-of-spectrum">Phase of Spectrum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spectra-with-averaging">Spectra with Averaging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lomb-scargle-periodograms-lombscargle">Lomb-Scargle Periodograms (<code class="xref py py-func docutils literal notranslate"><span class="pre">lombscargle</span></code>)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#short-time-fourier-transform">Short-Time Fourier Transform</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sliding-windows">Sliding Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-stft-and-dual-windows">Inverse STFT and Dual Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-with-legacy-implementation">Comparison with Legacy Implementation</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2008-2024, The SciPy community.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>